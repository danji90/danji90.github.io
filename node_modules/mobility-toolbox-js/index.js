!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("mobility-toolbox-js",[],e):"object"==typeof exports?exports["mobility-toolbox-js"]=e():t["mobility-toolbox-js"]=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=20)}([function(t,e){t.exports=require("ol/proj")},function(t,e){t.exports=require("ol/Observable")},function(t,e){t.exports=require("ol/extent")},function(t,e){t.exports=require("ol/style")},function(t,e){t.exports=require("query-string")},function(t,e){t.exports=require("ol/format/GeoJSON")},function(t,e){t.exports=require("ol/geom")},function(t,e){t.exports=require("ol/layer")},function(t,e){t.exports=require("ol/Feature")},function(t,e){t.exports=require("ol/Object")},function(t,e){t.exports=require("ol/layer/Layer")},function(t,e){t.exports=require("mapbox-gl")},function(t,e){t.exports=require("ol/source/Source")},function(t,e){t.exports=require("ol/geom/GeometryType")},function(t,e){t.exports=require("ol/Map")},function(t,e){t.exports=require("ol/control")},function(t,e){t.exports=require("ol/layer/Group")},function(t,e){t.exports=require("uuid")},function(t,e){t.exports=require("ol/source")},function(t,e){t.exports=require("ol/geom/Point")},function(t,e,r){t.exports=r(21)},function(t,e,r){"use strict";r.r(e);var n=r(14),o=r.n(n),i=r(15),c=r(1),a=r.n(c),u=r(16),s=r.n(u),l=r(17);function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function y(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?p(Object(r),!0).forEach((function(e){h(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function h(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function b(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g(t);if(e){var o=g(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return d(this,r)}}function d(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var O=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}(i,t);var e,r,n,o=m(i);function i(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this)).defineProperties(y({isQueryable:!0},t)),t.copyrights&&(e.copyrights=t.copyrights);var r=t.onClick;return r&&e.onClick(r),e}return e=i,(r=[{key:"defineProperties",value:function(t){var e=this,r=t.name,n=t.key,o=t.children,i=t.visible,c=t.properties,a=t.isBaseLayer,u=t.isQueryable,s=Object(l.v4)(),f=r||s;Object.defineProperties(this,{options:{value:t},name:{value:f},key:{value:n||f.toLowerCase()},isBaseLayer:{value:!!a},isQueryable:{value:!!u},isReactSpatialLayer:{value:!0},children:{value:o||[],writable:!0},copyrights:{get:function(){return e.get("copyrights")},set:function(t){var r=Array.isArray(t)?t:[t];return e.set("copyrights",r)}},visible:{value:void 0===i||i,writable:!0},properties:{value:y({},c||{})},map:{writable:!0},clickCallbacks:{value:[]}})}},{key:"init",value:function(t){this.terminate(),this.map=t}},{key:"terminate",value:function(){}},{key:"get",value:function(t){return this.properties[t]}},{key:"set",value:function(t,e){this.properties[t]=e,this.dispatchEvent({type:"change:".concat(t),target:this})}},{key:"setVisible",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t!==this.visible&&(this.visible=t,this.dispatchEvent({type:"change:visible",target:this,stopPropagationDown:e,stopPropagationUp:r,stopPropagationSiblings:n}))}},{key:"getVisibleChildren",value:function(){return this.children.filter((function(t){return t.visible}))}},{key:"hasVisibleChildren",value:function(){return!!this.hasChildren(!0)}},{key:"hasChildren",value:function(t){return!!this.children.find((function(e){return e.visible===t}))}},{key:"addChild",value:function(t){this.children.unshift(t),this.dispatchEvent({type:"change:children",target:this})}},{key:"removeChild",value:function(t){for(var e=0;e<this.children.length;e+=1)if(this.children[e].name===t)return void this.children.splice(e,1);this.dispatchEvent({type:"change:children",target:this})}},{key:"getFeatureInfoAtCoordinate",value:function(){return Promise.resolve({layer:this,features:[],coordinate:null})}},{key:"onClick",value:function(t){if("function"!=typeof t)throw new Error("callback must be of type function.");this.clickCallbacks.includes(t)||this.clickCallbacks.push(t)}},{key:"unClick",value:function(t){if("function"==typeof t){var e=this.clickCallbacks.indexOf(t);e>=-1&&this.clickCallbacks.splice(e,1)}}}])&&b(e.prototype,r),n&&b(e,n),i}(a.a);function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function w(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function P(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?w(Object(r),!0).forEach((function(e){S(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function S(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function k(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function T(t,e,r){return(T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function R(t,e){return(R=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function C(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=_(t);if(e){var o=_(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return D(this,r)}}function D(t,e){return!e||"object"!==j(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var E=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&R(t,e)}(i,t);var e,r,n,o=C(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).olLayer&&e.olLayer.setVisible(e.visible),e}return e=i,(r=[{key:"defineProperties",value:function(t){T(_(i.prototype),"defineProperties",this).call(this,t),Object.defineProperties(this,{olLayer:{value:t.olLayer,writable:!0},olListenersKeys:{value:[]}})}},{key:"init",value:function(t){var e=this;if(T(_(i.prototype),"init",this).call(this,t),this.map&&this.olLayer&&(this.olListenersKeys.push(this.map.getLayers().on("remove",(function(t){t.element===e.olLayer&&e.terminate()}))),this.copyrights)){var r=this.copyrights||[];this.olLayer instanceof s.a?this.olLayer.getLayers().getArray().forEach((function(t){t.getSource().setAttributions(r)})):this.olLayer.getSource().setAttributions(r)}}},{key:"terminate",value:function(){Object(c.unByKey)(this.olListenersKeys),T(_(i.prototype),"terminate",this).call(this)}},{key:"setVisible",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t!==this.visible&&(T(_(i.prototype),"setVisible",this).call(this,t,e,r,n),this.olLayer&&this.olLayer.setVisible(this.visible))}},{key:"clone",value:function(t){return new i(P(P({},this.options),t))}}])&&k(e.prototype,r),n&&k(e,n),i}(O),x=r(9),I=r.n(x);function M(t){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function A(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function L(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?A(Object(r),!0).forEach((function(e){V(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function V(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function U(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function F(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function q(t,e){return(q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function N(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=B(t);if(e){var o=B(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return K(this,r)}}function K(t,e){return!e||"object"!==M(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function B(t){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Z=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&q(t,e)}(i,t);var e,r,n,o=N(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};U(this,i),(t=o.call(this,e)).defineProperties(e);var r=L({active:!1!==e.active},e),n=r.active;return t.active=n,t}return e=i,(r=[{key:"defineProperties",value:function(t){var e=this,r=L({},t),n=r.target,o=r.element,i=r.render;Object.defineProperties(this,{active:{get:function(){return e.get("active")},set:function(t){e.set("active",t),t?e.activate():e.deactivate(),e.render()}},map:{get:function(){return e.get("map")},set:function(t){if(e.map&&e.element&&e.element.parentNode&&e.element.parentNode.removeChild(e.element),e.deactivate(),e.set("map",t),e.map){var r=e.target||e.map.getContainer();e.element||e.createDefaultElement(),e.element&&r.appendChild(e.element),e.active&&e.activate()}e.render()}},target:{value:n},element:{value:o,writable:!0},render:{value:i||this.render,writable:!0}})}},{key:"activate",value:function(){this.deactivate()}},{key:"deactivate",value:function(){}},{key:"render",value:function(){}},{key:"createDefaultElement",value:function(){}}])&&F(e.prototype,r),n&&F(e,n),i}(I.a);function z(t){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function G(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function H(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?G(Object(r),!0).forEach((function(e){W(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):G(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function W(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function $(t,e,r){return($="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=X(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function J(t,e){return(J=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=X(t);if(e){var o=X(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Y(this,r)}}function Y(t,e){return!e||"object"!==z(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function rt(t,e,r){return e&&et(t.prototype,e),r&&et(t,r),t}var nt=function(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&J(t,e)}(r,t);var e=Q(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return tt(this,r),(t=e.call(this,H(H({},n),{},{layers:[],controls:[]}))).mobilityLayers=[],t.mobilityControls=[],(n.controls||[]).forEach((function(e){t.addControl(e)})),(n.layers||[]).forEach((function(e){t.addLayer(e)})),t}return rt(r,[{key:"getMobilityLayers",value:function(){return this.mobilityLayers}},{key:"getMobilityControls",value:function(){return this.mobilityControls}},{key:"addMobilityControl",value:function(t){this.mobilityControls.push(t),t.map=this}},{key:"removeMobilityControl",value:function(t){t.map=null,this.mobilityControls=this.mobilityControls.filter((function(e){return e!==t}))}},{key:"addControl",value:function(t,e){t instanceof Z?this.addMobilityControl(t):$(X(r.prototype),"addControl",this).call(this,t,e)}},{key:"removeControl",value:function(t){t instanceof Z?this.removeMobilityControl(t):$(X(r.prototype),"removeControl",this).call(this,t)}}]),r}(t)},ot=r(10),it=r.n(ot);function ct(t){return(ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function at(t,e){return(at=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ut(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=lt(t);if(e){var o=lt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return st(this,r)}}function st(t,e){return!e||"object"!==ct(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function lt(t){return(lt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ft(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function yt(t,e,r){return e&&pt(t.prototype,e),r&&pt(t,r),t}var ht=function(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&at(t,e)}(r,t);var e=ut(r);function r(){return ft(this,r),e.apply(this,arguments)}return yt(r,[{key:"render",value:function(){this.element&&(this.element.innerHTML=this.active?this.getCopyrights().join(" | "):"")}},{key:"createDefaultElement",value:function(){this.element=document.createElement("div"),this.element.id="mbt-copyright",Object.assign(this.element.style,{position:"absolute",bottom:0,right:0,fontSize:".8rem",padding:"0 10px"})}}]),r}(t)};function bt(t){return function(t){if(Array.isArray(t))return vt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return vt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var mt=function(t){var e=t.filter((function(t){return null!=t&&t.trim&&t.trim()})),r=e.map((function(t){return t.toLowerCase()}));return bt(new Set(r)).map((function(t){return e.find((function(e){return e.toLowerCase()===t}))}))};function dt(t){return(dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ot(t,e,r){return(Ot="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=kt(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function jt(t,e){return(jt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=kt(t);if(e){var o=kt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Pt(this,r)}}function Pt(t,e){return!e||"object"!==dt(e)&&"function"!=typeof e?St(t):e}function St(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function kt(t){return(kt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Tt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jt(t,e)}(i,t);var e,r,n,o=wt(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).onPostRender=e.onPostRender.bind(St(e)),e}return e=i,(r=[{key:"getCopyrights",value:function(){var t=this;if(!this.frameState)return[];var e=[];return this.frameState.layerStatesArray.forEach((function(r){var n=r.layer;Object(ot.inView)(r,t.frameState.viewState)&&n&&n.getSource&&n.getSource()&&n.getSource().getAttributions()&&(e=e.concat(n.getSource().getAttributions()(t.frameState)))})),mt(e)}},{key:"activate",value:function(){Ot(kt(i.prototype),"activate",this).call(this),this.map&&this.map.on("postrender",this.onPostRender)}},{key:"deactivate",value:function(){this.map&&this.map.un("postrender",this.onPostRender),Ot(kt(i.prototype),"deactivate",this).call(this)}},{key:"onPostRender",value:function(t){this.map&&this.element&&(this.frameState=t.frameState,this.render())}}])&&gt(e.prototype,r),n&&gt(e,n),i}(ht(Z));function Rt(t){return(Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ct(t){return function(t){if(Array.isArray(t))return Dt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Dt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _t(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Et(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_t(Object(r),!0).forEach((function(e){xt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_t(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function xt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function It(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Mt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function At(t,e,r){return(At="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ft(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function Lt(t,e){return(Lt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ft(t);if(e){var o=Ft(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ut(this,r)}}function Ut(t,e){return!e||"object"!==Rt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ft(t){return(Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Lt(t,e)}(c,t);var e,r,n,o=Vt(c);function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return It(this,c),o.call(this,Et({controls:[].concat(Ct(Object(i.defaults)({attribution:!1}).getArray()),[new Tt])},t))}return e=c,(r=[{key:"getContainer",value:function(){return this.getTargetElement()}},{key:"addLayer",value:function(t){t instanceof E?(t.init(this),this.mobilityLayers.push(t),t.olLayer&&At(Ft(c.prototype),"addLayer",this).call(this,t.olLayer),this.dispatchEvent({type:"change:mobilityLayers",target:this})):At(Ft(c.prototype),"addLayer",this).call(this,t)}},{key:"removeLayer",value:function(t){t instanceof E?(t.terminate(),this.mobilityLayers=this.mobilityLayers.filter((function(e){return e!==t})),t.olLayer&&At(Ft(c.prototype),"removeLayer",this).call(this,t)):At(Ft(c.prototype),"removeLayer",this).call(this,t)}},{key:"addControl",value:function(t){At(Ft(c.prototype),"addControl",this).call(this,t)}},{key:"removeControl",value:function(t){At(Ft(c.prototype),"removeControl",this).call(this,t)}}])&&Mt(e.prototype,r),n&&Mt(e,n),c}(nt(o.a)),Nt=r(5),Kt=r.n(Nt);function Bt(t){return(Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function zt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Zt(Object(r),!0).forEach((function(e){Gt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Zt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Gt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function $t(t,e,r){return($t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Xt(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function Jt(t,e){return(Jt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Qt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Xt(t);if(e){var o=Xt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Yt(this,r)}}function Yt(t,e){return!e||"object"!==Bt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Xt(t){return(Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var te=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Jt(t,e)}(i,t);var e,r,n,o=Qt(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ht(this,i),(t=o.call(this,e)).abortController=new AbortController,t.format=new Kt.a,t}return e=i,(r=[{key:"getFeatureInfoUrl",value:function(t){var e=this.map.getView().getProjection(),r=this.map.getView().getResolution();return!!this.olLayer.getSource().getFeatureInfoUrl&&this.olLayer.getSource().getFeatureInfoUrl(t,r,e,{info_format:"application/json",query_layers:this.olLayer.getSource().getParams().layers})}},{key:"getFeatureInfoAtCoordinate",value:function(t){var e=this;this.abortController.abort(),this.abortController=new AbortController;var r=this.abortController.signal;return fetch(this.getFeatureInfoUrl(t),{signal:r}).then((function(t){return t.json()})).then((function(t){return t.features})).then((function(r){return{layer:e,coordinate:t,features:r.map((function(t){return e.format.readFeature(t)}))}})).catch((function(){return Promise.resolve({features:[],coordinate:t,layer:e})}))}},{key:"init",value:function(t){var e=this;$t(Xt(i.prototype),"init",this).call(this,t),this.map&&(this.singleClickRef=this.map.on("singleclick",(function(t){e.clickCallbacks.length&&e.getFeatureInfoAtCoordinate(t.coordinate).then((function(t){return e.callClickCallbacks(t.features,t.layer,t.coordinate)}))})))}},{key:"callClickCallbacks",value:function(t,e,r){this.clickCallbacks.forEach((function(n){return n(t,e,r)}))}},{key:"terminate",value:function(){$t(Xt(i.prototype),"terminate",this).call(this),this.singleClickRef&&Object(c.unByKey)(this.singleClickRef)}},{key:"clone",value:function(t){return new i(zt(zt({},this.options),t))}}])&&Wt(e.prototype,r),n&&Wt(e,n),i}(E),ee=r(0),re=r(11),ne=r.n(re),oe=r(12),ie=r.n(oe),ce=function(t){if(!t||!t.style)return[];var e=t.style.sourceCaches,r=[];return Object.values(e).forEach((function(t){if(t.used){var e=t.getSource(),n=e.attribution||e.options&&e.options.attribution;n&&(r=r.concat(n.replace(/&copy;/g,"Â©").split(/(<a.*?<\/a>)/)))}})),mt(r)},ae=r(4),ue=r.n(ae);function se(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function le(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?se(Object(r),!0).forEach((function(e){fe(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function fe(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var pe=function(t,e,r){if(!1===t)return r;var n=ue.a.parseUrl(r);return!t&&n.query[e]?r:t?ue.a.stringifyUrl(le(le({},n),{},{query:le(le({},n.query),{},fe({},e,t))})):(console.warn("No apiKey is defined for request to ".concat(r)),null)};function ye(t){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function he(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var c,a=t[Symbol.iterator]();!(n=(c=a.next()).done)&&(r.push(c.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return be(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return be(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ve(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function me(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ve(Object(r),!0).forEach((function(e){de(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ve(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function de(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ge(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Oe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function je(t,e,r){return(je="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Te(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function we(t,e){return(we=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Pe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Te(t);if(e){var o=Te(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Se(this,r)}}function Se(t,e){return!e||"object"!==ye(e)&&"function"!=typeof e?ke(t):e}function ke(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Te(t){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Re=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&we(t,e)}(i,t);var e,r,n,o=Pe(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ge(this,i);var r=new it.a({source:new ie.a({}),render:function(e){if(!t.mbMap)return console.warn("Mapbox map doesn't exist."),null;var r=!1,n=t.mbMap.getCanvas(),o=e.viewState,i=t.olLayer.getVisible();t.renderState.visible!==i&&(n.style.display=i?"block":"none",t.renderState.visible=i,n.style.position="absolute");var c=t.olLayer.getOpacity();t.renderState.opacity!==c&&(n.style.opacity=c,t.renderState.opacity=c);var a=o.rotation;t.renderState.rotation!==a&&(t.mbMap.rotateTo(180*-(a||0)/Math.PI,{animate:!1}),r=!0,t.renderState.rotation=a),t.renderState.zoom===o.zoom&&t.renderState.center[0]===o.center[0]&&t.renderState.center[1]===o.center[1]||(t.mbMap.jumpTo({center:Object(ee.toLonLat)(o.center),zoom:o.zoom-1,animate:!1}),r=!0,t.renderState.zoom=o.zoom,t.renderState.center=o.center);var u=t.map.getSize();if(t.renderState.size[0]===u[0]&&t.renderState.size[1]===u[1]||(r=!0,t.renderState.size=u),t.mbMap&&t.mbMap.style&&t.mbMap.isStyleLoaded()&&r)try{t.mbMap._frame&&(t.mbMap._frame.cancel(),t.mbMap._frame=null),t.mbMap._render()}catch(t){console.warn(t)}return n}});return(t=o.call(this,me(me({},e),{},{olLayer:r}))).styleUrl=e.url,t.apiKey=e.apiKey,t.apiKeyName=e.apiKeyName||"key",t.updateAttribution=t.updateAttribution.bind(ke(t)),t}return e=i,(r=[{key:"init",value:function(t){var e=this;je(Te(i.prototype),"init",this).call(this,t),this.map&&!this.mbMap&&(this.format=new Kt.a({featureProjection:this.map.getView().getProjection()}),this.loadMbMap(),this.olListenersKeys.push(this.map.on("change:size",(function(){try{e.mbMap&&e.mbMap.resize()}catch(t){console.warn(t)}}))))}},{key:"createStyleUrl",value:function(){return pe(this.apiKey,this.apiKeyName,this.styleUrl)}},{key:"loadMbMap",value:function(){var t=this;if(this.olListenersKeys.push(this.map.on("change:target",(function(){t.loadMbMap()}))),this.map.getTargetElement())if(this.visible){var e=he(this.map.getView().getCenter(),2),r=e[0],n=e[1];r&&n||(r=0,n=0);var o=this.createStyleUrl();try{this.mbMap=new ne.a.Map({style:o,attributionControl:!1,boxZoom:!1,center:Object(ee.toLonLat)([r,n]),container:this.map.getTargetElement(),interactive:!1,fadeDuration:"fadeDuration"in this.options?this.options.fadeDuration:300,preserveDrawingBuffer:this.options.preserveDrawingBuffer||!1})}catch(t){console.warn("Failed creating mapbox map: ",t)}this.renderState={center:[r,n],zoom:null,rotation:null,visible:null,opacity:null,size:[0,0]},this.mbMap.once("load",(function(){t.loaded=!0,t.copyrights=t.copyrights||ce(t.mbMap)||[],t.olLayer.getSource().setAttributions(t.copyrights),t.dispatchEvent({type:"load",target:t})}));var i=this.mbMap.getCanvas();i&&(this.options.tabIndex?i.setAttribute("tabindex",this.options.tabIndex):i.removeAttribute("tabindex")),this.mbMap.on("idle",this.updateAttribution)}else this.olListenersKeys.push(this.once("change:visible",(function(){t.loadMbMap()})))}},{key:"updateAttribution",value:function(t){var e=this.copyrights||ce(t.target)||[];this.copyrights.toString()!==e.toString()&&this.olLayer.getSource().setAttributions(e)}},{key:"getFeatureInfoAtCoordinate",value:function(t,e){var r=this;if(!(e&&this.format&&this.mbMap&&this.mbMap.isStyleLoaded()))return Promise.resolve({coordinate:t,features:[],layer:this});var n=t&&this.mbMap.project(Object(ee.toLonLat)(t)),o=this.mbMap.queryRenderedFeatures(n,e).map((function(t){var e=r.format.readFeature(t);return e&&e.set("mapboxFeature",t),e}));return Promise.resolve({layer:this,features:o,coordinate:t})}},{key:"terminate",value:function(){this.mbMap&&(this.mbMap.off("idle",this.updateAttribution),this.mbMap.triggerRepaint=function(){},this.mbMap.remove(),this.mbMap=null),this.loaded=!1,je(Te(i.prototype),"terminate",this).call(this)}},{key:"clone",value:function(t){return new i(me(me({},this.options),t))}}])&&Oe(e.prototype,r),n&&Oe(e,n),i}(E);var Ce=r(8),De=r.n(Ce),_e=r(2),Ee=r(6),xe=r(3),Ie=r(7),Me=r(18),Ae=r(13),Le=r.n(Ae);function Ve(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var c,a=t[Symbol.iterator]();!(n=(c=a.next()).done)&&(r.push(c.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Ue(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ue(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ue(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Fe(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function qe(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ke=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Fe(Object(r),!0).forEach((function(e){qe(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Fe(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({interpolate:!0},e);this.trajectories=[],this.renderedTrajectories=[],this.interpolate=!!r.interpolate,this.getPixelFromCoordinate=r.getPixelFromCoordinate,this.hoverVehicleId=null,this.iconScale=r.iconScale,this.canvas=r.canvas||document.createElement("canvas"),this.canvas.width=r.width,this.canvas.height=r.height,this.canvas.setAttribute("style",["position: absolute","top: 0","bottom: 0","right: 0","left: 0","pointer-events: none","visibility: visible","margin-top: inherit"].join(";")),this.canvasContext=this.canvas.getContext("2d")}var e,r,n;return e=t,(r=[{key:"setVisible",value:function(t){this.canvas&&(this.canvas.style.visibility=t?"visible":"hidden")}},{key:"setTrajectories",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.sort&&t.sort(this.sort),this.trajectories=t}},{key:"getTrajectories",value:function(){return this.trajectories||[]}},{key:"getRenderedTrajectories",value:function(){return this.renderedTrajectories}},{key:"clear",value:function(){this.canvasContext&&this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"setFilter",value:function(t){this.filter=t}},{key:"setSort",value:function(t){this.sort=t}},{key:"setHoverVehicleId",value:function(t){t!==this.hoverVehicleId&&(this.hoverVehicleId=t)}},{key:"setIconScale",value:function(t){this.iconScale=t}},{key:"setStyle",value:function(t){this.style=t}},{key:"renderTrajectories",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;this.clear();var n,o,i,c,a=Ve(e,2),u=a[0],s=a[1];if(u&&s&&(this.canvas.width!==u||this.canvas.height!==s)){var l=[u,s];this.canvas.width=l[0],this.canvas.height=l[1]}this.currResolution=r||this.currResolution;for(var f=(this.trajectories||[]).length-1;f>=0;f-=1){var p=this.trajectories[f],y=p.geometry,h=p.timeIntervals,b=p.timeOffset;if(!this.filter||this.filter(p)){var v=null,m=void 0;if(h&&h.length>1){for(var d=t-(b||0),g=void 0,O=void 0,j=void 0,w=void 0,P=void 0,S=0;S<h.length-1;S+=1){var k=Ve(h[S],3);g=k[0],j=k[1],m=k[2];var T=Ve(h[S+1],2);if(O=T[0],w=T[1],g<=d&&d<=O)break;g=null,O=null}if(y.getType()===Le.a.POINT)v=y.getCoordinate();else if(y.getType()===Le.a.LINE_STRING){if(g&&O){P=this.interpolate?Math.min((d-g)/(O-g),1):0;var R=this.interpolate?P*(w-j)+j:0;v=y.getCoordinateAt(R),this.trajectories[f].rotation=m,this.trajectories[f].endFraction=P}else if(d<h[0][0]){var C=Ve(h,1),D=Ve(C[0],3);m=D[2],P=0,v=y.getFirstCoordinate()}else if(d>h[h.length-1][0]){var _=Ve(h[h.length-1],3);m=_[2],P=1,v=y.getLastCoordinate()}}else console.error("This geometry type is not supported. Only Point or LineString are. Current geometry: ",y);this.trajectories[f].rotation=m,this.trajectories[f].endFraction=P||0}if(v){this.trajectories[f].coordinate=v;var E=this.getPixelFromCoordinate(v);if(!E)continue;this.trajectories[f].rendered=!0;var x=this.style(p,this.currResolution),I=x.width,M=x.height;this.iconScale&&(M=Math.floor(M*this.iconScale),I=Math.floor(I*this.iconScale)),this.hoverVehicleId!==p.id?this.canvasContext.drawImage(x,E[0]-I/2,E[1]-M/2,I,M):(n=x,o=E,i=I,c=M)}}}n&&this.canvasContext.drawImage(n,o[0]-i/2,o[1]-c/2,i,c),this.renderedTrajectories=this.trajectories.filter((function(t){return t.rendered}))}},{key:"destroy",value:function(){Object(c.unByKey)(this.olEventsKeys),this.renderedTrajectories=[],this.clear()}}])&&Ne(e.prototype,r),n&&Ne(e,n),t}(),Be={0:[5,5,5,5,5,7,7,7,7,7,7,7,7,7,7,7,7],1:[5,5,5,5,5,7,7,7,7,7,7,7,7,7,7,7,7],2:[5,5,5,5,5,7,7,7,7,7,9,12.5,14,15,15,15,15],3:[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],4:[5,5,5,5,5,7,7,7,7,7,7,7,7,7,7,7,7],5:[5,5,5,5,5,7,7,7,7,7,7,7,7,7,7,7,7],6:[5,5,5,5,5,7,7,7,7,7,7,7,7,7,7,7,7],7:[5,5,5,5,5,7,7,7,7,7,7,7,7,7,7,7,7],8:[5,5,5,5,5,7,7,7,7,7,7,7,7,7,7,7,7],9:[5,5,5,5,5,7,7,7,7,7,9,12.5,14,15,15,15,15]},Ze=["Tram","Subway / Metro / S-Bahn","Train","Bus","Ferry","Cable Car","Gondola","Funicular","Long distance bus","Rail"],ze=["#ffb400","#ff5400","#ff8080","#ea0000","#3000ff","#ffb400","#41a27b","#00d237","#b5b5b5","#ff8080"],Ge=["#000000","#ffffff","#000000","#ffffff","#ffffff","#000000","#ffffff","#000000","#000000","#000000"],He=[1e5,5e4,4e4,3e4,2e4,15e3,1e4,5e3,2e3,1e3,400,300,250,180,90,60,50,50,50,50,50],We=function(t){if("string"==typeof t){var e=Ze.find((function(e){return new RegExp(t).test(e)}));return Ze.indexOf(e)}return t},$e=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{var e=We(t);return ze[e]}catch(t){return 1}},Je=function(t,e,r){return e?r?"#ff0000":"#a0a0a0":t>=36e5?"#ed004c":t>=5e5?"#e80000":t>=3e5?"#ff4a00":t>=18e4?"#f7bf00":null===t?"#a0a0a0":"#00a00c"};function Qe(t){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ye(t){return function(t){if(Array.isArray(t))return Xe(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Xe(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xe(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xe(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function tr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function er(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function rr(t,e,r){return(rr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=cr(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function nr(t,e){return(nr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function or(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=cr(t);if(e){var o=cr(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return ir(this,r)}}function ir(t,e){return!e||"object"!==Qe(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function cr(t){return(cr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ar(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ur(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function sr(t,e,r){return e&&ur(t.prototype,e),r&&ur(t,r),t}var lr=function(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&nr(t,e)}(r,t);var e=or(r);function r(){return ar(this,r),e.apply(this,arguments)}return sr(r,[{key:"defineProperties",value:function(t){var e=this,n=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?tr(Object(r),!0).forEach((function(e){er(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({isHoverActive:!0},t),o=n.isHoverActive,i=n.style,c=n.speed||1;rr(cr(r.prototype),"defineProperties",this).call(this,t),Object.defineProperties(this,{isTrackerLayer:{value:!0},isHoverActive:{value:!!o,writable:!0},style:{value:i||this.defaultStyle},speed:{get:function(){return c},set:function(t){c=t,e.start()}},filter:{get:function(){return e.tracker.filter},set:function(t){e.tracker&&e.tracker.setFilter(t)}},sort:{get:function(){return e.tracker.sort},set:function(t){e.sort&&e.tracker.setSort(t)}},tracker:{value:null,writable:!0},styleCache:{value:{}},currTime:{value:new Date,writable:!0},lastUpdateTime:{value:new Date,writable:!0},renderedTrajectories:{get:function(){return e.tracker.renderedTrajectories}}})}},{key:"init",value:function(t,e){var n=this;rr(cr(r.prototype),"init",this).call(this,t),this.tracker=new Ke(e),this.tracker.setStyle((function(t,e){return n.style(t,e)})),this.visible&&this.start(),this.visibilityRef=this.on("change:visible",(function(t){t.target.visible?n.start():n.stop()}))}},{key:"terminate",value:function(){this.stop(),Object(c.unByKey)(this.visibilityRef),this.tracker&&(this.tracker.destroy(),this.tracker=null),rr(cr(r.prototype),"terminate",this).call(this)}},{key:"start",value:function(t,e,r){this.stop(),this.tracker.setVisible(!0),this.tracker.renderTrajectories(this.currTime,t,r),this.startUpdateTime(e)}},{key:"startUpdateTime",value:function(t){var e=this;this.stopUpdateTime(),this.updateTimeInterval=setInterval((function(){var t=e.currTime.getTime()+(new Date-e.lastUpdateTime)*e.speed;e.setCurrTime(t)}),this.getRefreshTimeInMs(t))}},{key:"stop",value:function(){this.stopUpdateTime(),this.tracker&&(this.tracker.setVisible(!1),this.tracker.clear())}},{key:"stopUpdateTime",value:function(){this.updateTimeInterval&&clearInterval(this.updateTimeInterval)}},{key:"setCurrTime",value:function(t,e,r){var n=new Date(t);this.currTime=n,this.lastUpdateTime=new Date,this.tracker.renderTrajectories(this.currTime,e,r)}},{key:"getVehicle",value:function(t){return this.tracker.getTrajectories().filter(t)}},{key:"getVehiclesAtCoordinate",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=Object(_e.buffer)([].concat(Ye(t),Ye(t)),10*e),n=this.tracker.getTrajectories(),o=[],i=0;i<n.length;i+=1)n[i].coordinate&&Object(_e.containsCoordinate)(r,n[i].coordinate)&&o.push(n[i]);return o}},{key:"getRefreshTimeInMs",value:function(t){var e=Math.round(t),r=He[e]||25;return Math.max(25,r/this.speed)}},{key:"defaultStyle",value:function(t){var e=t.id;if(this.styleCache[e])return this.styleCache[e];var r=document.createElement("canvas");r.width=200,r.height=15;var n=r.getContext("2d");return n.arc(8,8,5,0,2*Math.PI,!1),n.fillStyle="#8ED6FF",n.fill(),n.lineWidth=3,n.strokeStyle="black",n.stroke(),n.font="bold 12px arial",n.strokeStyle="white",n.lineWidth=3,n.strokeText(e,20,10),n.fillStyle="black",n.fillText(e,20,10),this.styleCache[e]=r,this.styleCache[e]}}]),r}(t)};function fr(t){return(fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var c,a=t[Symbol.iterator]();!(n=(c=a.next()).done)&&(r.push(c.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return yr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yr(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function hr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function br(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?hr(Object(r),!0).forEach((function(e){vr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):hr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function vr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function gr(t,e,r){return(gr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Pr(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function Or(t,e){return(Or=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function jr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Pr(t);if(e){var o=Pr(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return wr(this,r)}}function wr(t,e){return!e||"object"!==fr(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Pr(t){return(Pr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Sr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Or(t,e)}(i,t);var e,r,n,o=jr(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return mr(this,i),(t=o.call(this,br({},e))).olLayer=e.olLayer||new Ie.Group({layers:[new Ie.Layer({source:new ie.a({}),render:function(e){return t.tracker&&t.tracker.canvas?(t.tracker.renderTrajectories(t.currTime,e.size,e.viewState.resolution),t.tracker.canvas):null}})]}),t.olEventsKeys=[],t}return e=i,(r=[{key:"init",value:function(t){t&&gr(Pr(i.prototype),"init",this).call(this,t,{getPixelFromCoordinate:t.getPixelFromCoordinate.bind(t)})}},{key:"setCurrTime",value:function(t){var e=this.map.getView();gr(Pr(i.prototype),"setCurrTime",this).call(this,t,this.map.getSize(),e.getResolution())}},{key:"start",value:function(){var t=this;gr(Pr(i.prototype),"start",this).call(this,this.map.getSize(),this.currentZoom,this.map.getView().getResolution()),this.olEventsKeys=[this.map.on("moveend",(function(){var e=t.map.getView().getZoom();e!==t.currentZoom&&(t.currentZoom=e,t.startUpdateTime(e))})),this.map.on("pointermove",(function(e){if(!t.map.getView().getInteracting()&&t.isHoverActive){var r=pr(t.getVehiclesAtCoordinate(e.coordinate),1)[0];t.map.getTargetElement().style.cursor=r?"pointer":"auto",t.tracker.setHoverVehicleId(r&&r.id)}}))]}},{key:"stop",value:function(){gr(Pr(i.prototype),"stop",this).call(this),Object(c.unByKey)(this.olEventsKeys),this.olEventsKeys=[]}},{key:"getVehiclesAtCoordinate",value:function(t){var e=this.map.getView().getResolution();return gr(Pr(i.prototype),"getVehiclesAtCoordinate",this).call(this,t,e)}},{key:"clone",value:function(t){return new i(br(br({},this.options),t))}}])&&dr(e.prototype,r),n&&dr(e,n),i}(lr(E)),kr=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,e=(t.getUTCMonth()+1).toString();e=1===e.length?"0".concat(e):e;var r=t.getUTCDate().toString();return r=1===r.length?"0".concat(r):r,[t.getUTCFullYear(),e,r].join("")},Tr=function(t){return[t.getUTCHours(),t.getUTCMinutes(),"".concat(t.getUTCSeconds(),".").concat(t.getUTCMilliseconds())].join(":")};function Rr(t){return(Rr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Cr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Dr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Cr(Object(r),!0).forEach((function(e){_r(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Cr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function _r(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Er(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ir(t,e){return(Ir=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Mr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Lr(t);if(e){var o=Lr(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ar(this,r)}}function Ar(t,e){return!e||"object"!==Rr(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Lr(t){return(Lr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Vr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ir(t,e)}(i,t);var e,r,n,o=Mr(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Er(this,i),(t=o.call(this)).url=e.url,t.apiKey=e.apiKey,t}return e=i,(r=[{key:"fetch",value:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=Dr(Dr({},e),{},{key:this.apiKey}),o=Dr({},n);return Object.keys(n).forEach((function(t){return(void 0===o[t]||null===o[t])&&delete o[t]})),this.apiKey?fetch("".concat(this.url).concat(t,"?").concat(ue.a.stringify(o)),r).then((function(t){try{return t.json().then((function(t){if(t.error)throw new Error(t.error);return t}))}catch(t){return Promise.reject(new Error(t))}})):Promise.reject(new Error("No apiKey defined for request to ".concat(this.url)))}))}])&&xr(e.prototype,r),n&&xr(e,n),i}(I.a);function Ur(t){return(Ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function qr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Fr(Object(r),!0).forEach((function(e){Nr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Fr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Nr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Kr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Br(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Zr(t,e){return(Zr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function zr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Hr(t);if(e){var o=Hr(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Gr(this,r)}}function Gr(t,e){return!e||"object"!==Ur(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Hr(t){return(Hr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Wr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Zr(t,e)}(i,t);var e,r,n,o=zr(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Kr(this,i),o.call(this,qr({url:"https://api.geops.io/stops/v1/"},t))}return e=i,(r=[{key:"search",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.fetch("",t,{signal:e.signal}).then((function(t){return t.features}))}}])&&Br(e.prototype,r),n&&Br(e,n),i}(Vr),$r=function(t){for(var e=[],r=0;r<t.length;r+=1){var n=t[r],o=n.d,i=n.m,c=n.y;e.push({day:o,month:i,year:c})}return e},Jr=function(t){for(var e=t.id,r=t.hs,n=t.t,o=t.ln,i=t.sn,c=t.wa,a=t.ba,u=t.rt,s=t.fid,l=t.rid,f=t.c,p=t.tc,y=t.a,h=y.n,b=y.u,v=y.tz,m=t.f,d=m.n,g=m.u,O=m.tz,j=t.tt,w=j.n,P=j.p,S=j.t,k=t.sts,T=$r(w),R=$r(P),C=f&&"#".concat(f),D=p&&"#".concat(p),_=[],E=0;E<k.length;E+=1){var x=k[E],I=x.sid,M=x.n,A=x.p,L=x.at,V=x.dt,U=x.ap,F=x.dp,q=x.ad,N=x.dd,K=x.dot,B=x.put,Z=x.c,z=x.wa;_.push({stationId:I,stationName:M,coordinates:A,arrivalTime:-1!==L?1e3*U:null,departureTime:-1!==V?1e3*F:null,arrivalDelay:q,departureDelay:N,noDropOff:!!K,noPickUp:!!B,cancelled:!!Z,wheelchairAccessible:!!z})}return{id:e,destination:r,backgroundColor:C,color:D,vehicleType:n,routeIdentifier:l,longName:o,shortName:i,stations:_,wheelchairAccessible:!!c,bicyclesAllowed:!!a,realTime:u,feedsId:s,operatingInformations:{operatingPeriod:S,notOperatingDays:T,additionalOperatingDays:R},operator:h,operatorUrl:b,operatorTimeZone:v,publisher:d,publisherUrl:g,publisherTimeZone:O}},Qr=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=[],r=0;r<t.length;r+=1){var n=t[r],o=new Ee.LineString(n.geometry.coordinates),i=n.properties,c=i.ID,a=i.ProductIdentifier,u=i.PublishedLineName,s=i.RouteIdentifier,l=i.DirectionText,f=i.Operator,p=i.OperatorURL,y=i.Publisher,h=i.PublisherURL,b=i.License,v=i.LicenseUrl,m=i.LicenseNote,d=i.Color,g=i.JourneyIdentifier,O=i.RealtimeAvailable,j=i.OperatorProvidesRealtime,w=i.DayOfOperation,P=i.Delay,S=i.TimeIntervals,k=i.TextColor,T=i.Cancelled;e.push({id:c,type:a,name:u,routeIdentifier:s,directionText:l,operator:f,operatorUrl:p,publisher:y,publisherUrl:h,license:b,licenseUrl:v,licenseNote:m,journeyIdentifier:g,realtimeAvailable:O,operatorProvidesRealtime:j,dayOfOperation:w,delay:P,timeIntervals:S,color:d&&"#".concat(d),textColor:k&&"#".concat(k),geometry:o,cancelled:T})}return e};function Yr(t){return(Yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function tn(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Xr(Object(r),!0).forEach((function(e){en(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function en(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function rn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function on(t,e){return(on=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function cn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=un(t);if(e){var o=un(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return an(this,r)}}function an(t,e){return!e||"object"!==Yr(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function un(t){return(un=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var sn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&on(t,e)}(i,t);var e,r,n,o=cn(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return rn(this,i),o.call(this,tn({url:"https://api.geops.io/tracker/v1"},t))}return e=i,(r=[{key:"fetchTrajectoryById",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.fetch("/trajectorybyid",t,{signal:e.signal})}},{key:"fetchTrajectories",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.fetch("/trajectory_collection",t,{signal:e.signal}).then((function(t){return Qr(t.features)}))}},{key:"fetchTrajectoryStations",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.fetch("/trajstations",t,{signal:e.signal}).then((function(t){return Jr(t)}))}}])&&nn(e.prototype,r),n&&nn(e,n),i}(Vr);function ln(t){return function(t){if(Array.isArray(t))return fn(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return fn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fn(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function pn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var yn=function(){function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subscriptions=[],this.connect(e),setInterval((function(){r.send("PING")}),1e4)}var e,r,n;return e=t,n=[{key:"getRequestString",value:function(t,e){var r="".concat(t," ").concat(e.channel);return r+=e.args?" ".concat(e.args):"",(r+=e.id?" ".concat(e.id):"").trim()}}],(r=[{key:"connect",value:function(t){var e=this;this.websocket&&this.websocket.readyState!==this.websocket.CLOSED&&this.websocket.close(),this.websocket=new WebSocket(t),this.currentProj&&this.setProjection(this.currentProj),this.currentBbox&&this.setBbox(this.currentBbox),ln(this.subscriptions).forEach((function(t){e.subscribe(t.params,t.cb,t.errorCb,!0)})),this.websocket.onclose=function(){window.clearTimeout(e.reconnectTimeout),e.reconnectTimeout=window.setTimeout((function(){return e.connect(t)}),100)}}},{key:"get",value:function(e,r,n){var o=t.getRequestString("GET",e);this.send(o),this.listen(e,r,n)}},{key:"send",value:function(t){var e=this,r=function(){e.websocket.send(t)};this.websocket.readyState===WebSocket.CONNECTING?this.websocket.addEventListener("open",r):r()}},{key:"setProjection",value:function(t){this.currentProj=t,this.send("PROJECTION ".concat(t))}},{key:"setBbox",value:function(t){var e=this;this.currentBbox=t,this.send("BBOX ".concat(t.join(" "))),this.subscriptions.forEach((function(t){e.get(t.params,t.cb,t.errorCb)}))}},{key:"listen",value:function(t,e,r){var n=function(r){var n=JSON.parse(r.data),o=t.channel;o+=t.args?" ".concat(t.args):"",n.source!==o||t.id&&t.id!==n.client_reference||e(n)};return this.websocket.addEventListener("message",n),r&&(this.websocket.addEventListener("error",r),this.websocket.addEventListener("close",r)),{onMessage:n,onErrorCb:r}}},{key:"subscribe",value:function(e,r,n,o){var i=this.listen(e,r,n),c=i.onMessageCb,a=i.onErrorCb,u=t.getRequestString("",e);o||this.subscriptions.push({params:e,cb:r,errorCb:n,onMessageCb:c,onErrorCb:a}),this.send("GET ".concat(u)),this.send("SUB ".concat(u))}},{key:"unsubscribe",value:function(t){var e=this;this.subscriptions.filter((function(e){return e.params.channel===t})).forEach((function(t){var r=t.onMessageCb,n=t.onErrorCb;e.websocket.removeEventListener("message",r),n&&(e.websocket.removeEventListener("error",n),e.websocket.removeEventListener("close",n))})),this.subscriptions=this.subscriptions.filter((function(e){return e.params.channel!==t})),t&&this.send("DEL ".concat(t))}}])&&pn(e.prototype,r),n&&pn(e,n),t}(),hn=function(t,e){return t===e.SCHEMATIC?"_schematic":""},bn=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=["HIDDEN","LEAVING","BOARDING"],o=t.has_fzo&&n.indexOf(t.state)>-1,i=e.has_fzo&&n.indexOf(e.state)>-1;if(o||i){if(o!==i)return o?-1:1;if(t.state!==e.state)return n.indexOf(t.state)-n.indexOf(e.state)}var c=null,a=null,u=Date.now();return r?(c=new Date(t.min_arrival_time||t.time).getTime()-u,a=new Date(e.min_arrival_time||e.time).getTime()-u):(c=new Date(t.time).getTime()-u,a=new Date(e.time).getTime()-u),c-a},vn=function(t){if(t)return t.stations.forEach((function(t){t.arrivalTimeWithDelay=t.arrivalTime,t.departureTime&&(t.departureTimeWithDelay=t.departureTime),t.arrivalDelay&&(t.arrivalTime-=t.arrivalDelay,t.departureTime&&(t.departureTime-=t.arrivalDelay))})),t};function mn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var gn={RAW:"raw",TOPOGRAPHIC:"topographic",SCHEMATIC:"schematic"},On=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};mn(this,t);var r=null;r="string"==typeof e?e:e.url,e.apiKey&&(r="".concat(r,"?key=").concat(e.apiKey)),this.conn=new yn(r),this.conn.setProjection(e.projection||"epsg:3857"),this.subscribedStationUic=null,this.departureUpdateTimeout=null,this.maxDepartureAge=30,this.extraGeoms={}}var e,r,n;return e=t,(r=[{key:"subscribe",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.conn.subscribe({channel:t},e,r,n)}},{key:"unsubscribe",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.conn.unsubscribe("".concat(t).concat(hn(gn.SCHEMATIC,gn)).concat(e)),this.conn.unsubscribe("".concat(t).concat(hn(gn.TOPOGRAPHIC,gn)).concat(e))}},{key:"filterDepartures",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Object.keys(t).map((function(e){return t[e]}));r.sort((function(t,r){return bn(t,r,e)}));var n=new Date;n.setMinutes(n.getMinutes()+this.maxDepartureAge),n=n.getTime();var o=new Date;o.setMinutes(o.getMinutes()-this.maxDepartureAge),o=o.getTime();for(var i=[],c=[],a=null,u=r.length-1;u>=0;u-=1){var s=r[u],l=new Date(s.time).getTime();l>o&&l<n&&("BOARDING"===s.state&&(-1===c.indexOf(s.platform)?c.push(s.platform):s.state="HIDDEN"),a&&s.to[0]===a.to[0]&&Math.abs(l-a.time)<1e3&&s.line.name===a.line.name&&(s.state="HIDDEN"),/(STOP_CANCELLED|JOURNEY_CANCELLED)/.test(s.state)&&(s.cancelled=!0),(a=s).time=l,i.unshift(s))}return i}},{key:"subscribeDepartures",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;window.clearTimeout(this.departureUpdateTimeout),this.unsubscribeDepartures(),this.subscribedStationUic=t;var o=t?"timetable_".concat(t):null,i={};this.subscribe(o,(function(t){if(t.source===o){var c=t.content||{},a=new Date(c.timestamp).getTime()-Date.now();c.timediff=a,i[c.call_id]=c,window.clearTimeout(e.departureUpdateTimeout),e.departureUpdateTimeout=window.setTimeout((function(){var t=e.filterDepartures(i,r);n(t)}),100)}}),(function(){n([])}))}},{key:"unsubscribeDepartures",value:function(){this.subscribedStationUic&&(this.unsubscribe("timetable_".concat(this.subscribedStationUic)),this.subscribedStationUic=null)}},{key:"subscribeDisruptions",value:function(t){this.subscribe("newsticker",(function(e){t(e.content)}))}},{key:"unsubscribeDisruptions",value:function(){this.unsubscribe("newsticker")}},{key:"getStation",value:function(t,e){var r=this,n={channel:"station".concat(hn(e,gn)),args:t};return new Promise((function(t,e){r.conn.get(n,(function(r){r.content?t(r.content):e()}))}))}},{key:"getStations",value:function(t,e){var r=this,n=[];e&&this.conn.setBbox(e);var o={channel:"station".concat(hn(t,gn))};return window.clearTimeout(this.stationUpdateTimeout),new Promise((function(t,e){r.conn.get(o,(function(o){o.content?(n.push(o.content),window.clearTimeout(r.stationUpdateTimeout),r.stationUpdateTimeout=window.setTimeout((function(){t(n)}),50)):e(o.content)}))}))}},{key:"subscribeStations",value:function(t,e,r){this.unsubscribeStations(),e&&this.conn.setBbox(e),this.subscribe("station".concat(hn(t,gn)),(function(t){t.content&&r(t.content)}))}},{key:"unsubscribeStations",value:function(){window.clearTimeout(this.stationUpdateTimeout),this.unsubscribe("station")}},{key:"subscribeExtraGeoms",value:function(t){var e=this;this.subscribe("extra_geoms",(function(r){var n=r.content;if(n){var o=n.properties.ref;"Feature"===n.type?e.extraGeoms[o]=n:delete e.extraGeoms[o],t(Object.keys(e.extraGeoms).map((function(t){return e.extraGeoms[t]})))}}))}},{key:"unsubscribeExtraGeoms",value:function(){this.unsubscribe("extra_geoms")}},{key:"subscribeTrajectory",value:function(t,e){this.unsubscribeTrajectory(),this.subscribe("trajectory".concat(hn(t,gn)),e)}},{key:"unsubscribeTrajectory",value:function(){this.unsubscribe("trajectory")}},{key:"subscribeDeletedVehicles",value:function(t,e){this.unsubscribeDeletedVehicles(),this.subscribe("deleted_vehicles".concat(hn(t,gn)),e)}},{key:"unsubscribeDeletedVehicles",value:function(){this.unsubscribe("deleted_vehicles")}},{key:"getFullTrajectory",value:function(t,e){var r=this,n={channel:"full_trajectory".concat(hn(e,gn),"_").concat(t)};return new Promise((function(t){r.conn.get(n,(function(e){e.content&&t(e.content)}))}))}},{key:"getFullTrajectories",value:function(t,e){var r=this,n=t.map((function(t){return r.getFullTrajectory(t,e)}));return Promise.all(n)}},{key:"subscribeFullTrajectory",value:function(t,e){this.unsubscribeFullTrajectory(t),this.subscribe("full_trajectory".concat(hn(e,gn),"_").concat(t),(function(t){console.log("subscribe full_trajectory",t)}),(function(t){console.log("subscribe full_trajectory error",t)}))}},{key:"unsubscribeFullTrajectory",value:function(t){this.unsubscribe("full_trajectory","_".concat(t))}},{key:"getStopSequence",value:function(t,e){var r=this,n={channel:"stopsequence".concat(hn(e,gn),"_").concat(t)};return new Promise((function(t,e){r.conn.get(n,(function(e){t(vn(e.content&&e.content[0]))}),(function(t){e(t)}))}))}},{key:"getStopSequences",value:function(t,e){var r=this,n=t.map((function(t){return r.getStopSequence(t,e)}));return Promise.all(n)}},{key:"subscribeStopSequence",value:function(t,e,r){window.clearTimeout(this.fullTrajectoryUpdateTimeout),this.unsubscribeStopSequence(t),this.subscribe("stopsequence".concat(hn(e,gn),"_").concat(t),(function(t){r(vn(t.content&&t.content[0]))}),(function(t){console.log("subscribe stopsequence error",t)}))}},{key:"unsubscribeStopSequence",value:function(t){this.unsubscribe("stopsequence","_".concat(t))}},{key:"subscribeHealthCheck",value:function(t){this.unsubscribeHealthCheck(),this.subscribe("healthcheck",t)}},{key:"unsubscribeHealthCheck",value:function(){this.unsubscribe("healthcheck")}}])&&dn(e.prototype,r),n&&dn(e,n),t}();function jn(t){return(jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Pn(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?wn(Object(r),!0).forEach((function(e){Sn(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):wn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Sn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function kn(t,e,r){return(kn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Dn(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function Tn(t,e){return(Tn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Rn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Dn(t);if(e){var o=Dn(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Cn(this,r)}}function Cn(t,e){return!e||"object"!==jn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Dn(t){return(Dn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function En(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function xn(t,e,r){return e&&En(t.prototype,e),r&&En(t,r),t}var In=function(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Tn(t,e)}(r,t);var e=Rn(r);function r(){return _n(this,r),e.apply(this,arguments)}return xn(r,[{key:"defineProperties",value:function(t){var e=this;kn(Dn(r.prototype),"defineProperties",this).call(this,t);var n,o=t.regexPublishedLineName,i=t.publishedLineName,c=t.tripNumber,a=t.operator;if(!t.api){var u={};t.url&&(u.url=t.url),t.apiKey&&(u.apiKey=t.apiKey),n=new sn(u)}Object.defineProperties(this,{showVehicleTraj:{value:void 0===t.showVehicleTraj||t.showVehicleTraj,writable:!0},delayDisplay:{value:t.delayDisplay||3e5,writable:!0},delayOutlineColor:{value:t.delayOutlineColor||"#000000",writable:!0},useDelayStyle:{value:t.useDelayStyle||!1,writable:!0},requestIntervalSeconds:{value:3,writable:!0},publishedLineName:{get:function(){return i},set:function(t){i=t,e.updateFilters()}},tripNumber:{get:function(){return c},set:function(t){c=t,e.updateFilters()}},operator:{get:function(){return a},set:function(t){a=t,e.updateFilters()}},regexPublishedLineName:{get:function(){return o},set:function(t){o=t,e.updateFilters()}},api:{value:t.api||n}})}},{key:"init",value:function(t){kn(Dn(r.prototype),"init",this).call(this,t),this.sortFc?this.sort=this.sortFc:this.useDelayStyle&&(this.sort=function(t,e){return null===t.delay||t.delay<e.delay?1:-1})}},{key:"start",value:function(){this.updateFilters(),kn(Dn(r.prototype),"start",this).call(this),this.startUpdateTrajectories()}},{key:"stop",value:function(){this.journeyId=null,this.stopUpdateTrajectories(),this.abortFetchTrajectories(),kn(Dn(r.prototype),"stop",this).call(this)}},{key:"updateFilters",value:function(){var t=ue.a.parse(window.location.search.toLowerCase());this.filter=function(t,e,r,n){var o=[];if(!(t||e||r||n))return null;if(n){var i="string"==typeof n?[n]:n;o.push((function(t){return i.some((function(e){return new RegExp(e,"i").test(t.name)}))}))}if(t){var c=("string"==typeof t?t.split(","):t).map((function(t){return t.replace(/\s+/g,"").toUpperCase()}));o.push((function(t){return c.some((function(e){return e===t.name.toUpperCase()}))}))}if(e){var a=("string"==typeof e?e.split(","):e).map((function(t){return parseInt(t,10)}));o.push((function(t){var e=parseInt(t.routeIdentifier.split(".")[0],10);return a.some((function(t){return t===e}))}))}if(r){var u="string"==typeof r?[r]:r;o.push((function(t){return u.some((function(e){return new RegExp(e,"i").test(t.operator)}))}))}return o.length?function(t){for(var e=0;e<o.length;e+=1)if(!o[e](t))return!1;return!0}:null}(this.publishedLineName||t.publishedlinename,this.tripNumber||t.tripnumber,this.operator||t.operator,this.regexPublishedLineName)}},{key:"abortFetchTrajectories",value:function(){this.abortController&&this.abortController.abort()}},{key:"updateTrajectoryStations",value:function(t){var e=this.getParams({id:t,time:Tr(new Date)});return this.api.fetchTrajectoryStations(e)}},{key:"getParams",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=2e4*this.speed,r=this.currTime,n=!0;if(this.later&&r.getTime()>this.later.getTime()-3e3*this.speed&&(n=!1),!this.later||!n||this.later.getTime()-r.getTime()>e){var o=new Date(r.getTime()+e);this.later=o}var i=Pn(Pn({},t),{},{btime:Tr(r),etime:Tr(this.later),date:kr(r),rid:1,a:1,cd:1,nm:1,fl:1});return i}},{key:"startUpdateTrajectories",value:function(){var t=this;this.stopUpdateTrajectories(),this.updateTrajectories(),this.updateInterval=window.setInterval((function(){t.updateTrajectories()}),1e3*this.requestIntervalSeconds)}},{key:"stopUpdateTrajectories",value:function(){clearInterval(this.updateInterval)}},{key:"updateTrajectories",value:function(){var t=this;this.abortFetchTrajectories(),this.abortController=new AbortController,this.api.fetchTrajectories(this.getParams({attr_det:1}),this.abortController).catch((function(t){if("AbortError"!==t.name)throw t})).then((function(e){e&&t.tracker.setTrajectories(e)}))}},{key:"defaultStyle",value:function(t,e){var r=t.type,n=t.name,o=t.id,i=t.color,c=t.textColor,a=t.delay,u=t.cancelled,s=t.operatorProvidesRealtime,l=Math.min(Math.floor(e||1),16),f=this.tracker.hoverVehicleId===o,p=this.selectedVehicleId===o,y="".concat(l).concat(r).concat(n).concat(s).concat(a).concat(f).concat(p).concat(u);if(!this.styleCache[y]){var h=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0;try{var r=We(t);return Be[r][e]}catch(t){return 1}}(r,l);(f||p)&&(h+=5);var b=h+2,v=2*h,m=document.createElement("canvas");m.width=2*b+2+100,m.height=2*b+2+100;var d,g=m.getContext("2d"),O=m.width/2;if(null!==a&&(g.save(),g.beginPath(),g.arc(O,O,b,0,2*Math.PI,!1),g.fillStyle=Je(a,u),g.filter="blur(1px)",g.fill(),g.restore()),f||a>=this.delayDisplay||u){g.save(),g.textAlign="left",g.textBaseline="middle",g.font="bold ".concat(Math.max(u?19:14,Math.min(u?19:17,1.2*h)),"px arial, sans-serif"),g.fillStyle=Je(a,u,!0),g.strokeStyle=this.delayOutlineColor,g.lineWidth=1.5;var j=function(t,e){if(e)return String.fromCodePoint(215);if(t>36e5){var r=Math.round(t/36e5);return"+".concat(r,"h")}if(t>59e3){var n=Math.round(t/6e4);return"+".concat(n,"m")}return t>0?"+".concat(t,"s"):""}(a,u);g.strokeText(j,O+b+1,O),g.fillText(j,O+b+1,O),g.restore()}if(d=this.useDelayStyle?Je(a,u):i||$e(r),g.save(),g.lineWidth=1,g.strokeStyle="#000000",g.fillStyle=d,g.beginPath(),g.arc(O,O,h,0,2*Math.PI,!1),g.fill(),this.useDelayStyle&&null===a&&"yes"===s&&g.setLineDash([5,3]),g.stroke(),g.restore(),h>10){var w=function(t,e,r,n){t.font="bold ".concat(n,"px Arial");for(var o=t.measureText(r),i=0;o.width>e-6&&i<25;)n-=.5,t.font="bold ".concat(n,"px arial, sans-serif"),o=t.measureText(r),i+=1;return n}(g,v,n,Math.max(h,10));this.useDelayStyle&&null===a&&"yes"===s&&(g.save(),g.textBaseline="middle",g.textAlign="center",g.font="bold ".concat(w+2,"px Arial"),g.strokeStyle=d,g.strokeText(n,O,O),g.restore()),g.save(),g.textBaseline="middle",g.textAlign="center",g.fillStyle=this.useDelayStyle?"#000000":c||function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{var e=We(t);return Ge[e]}catch(t){return 1}}(r),g.font="bold ".concat(w,"px Arial"),g.strokeStyle=d,g.strokeText(n,O,O),g.fillText(n,O,O),g.restore()}this.styleCache[y]=m}return this.styleCache[y]}}]),r}(t)};function Mn(t){return(Mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function An(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var c,a=t[Symbol.iterator]();!(n=(c=a.next()).done)&&(r.push(c.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}(t,e)||Vn(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ln(t){return function(t){if(Array.isArray(t))return Un(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Vn(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vn(t,e){if(t){if("string"==typeof t)return Un(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Un(t,e):void 0}}function Un(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Fn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function qn(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Fn(Object(r),!0).forEach((function(e){Nn(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Fn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Nn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Kn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Bn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Zn(t,e,r){return(Zn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Wn(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function zn(t,e){return(zn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Gn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Wn(t);if(e){var o=Wn(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Hn(this,r)}}function Hn(t,e){return!e||"object"!==Mn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Wn(t){return(Wn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var $n=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&zn(t,e)}(i,t);var e,r,n,o=Gn(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Kn(this,i),(t=o.call(this,qn({},e))).vectorLayer=new Ie.Vector({source:new Me.Vector({features:[]})}),t.olLayer.getLayers().insertAt(0,t.vectorLayer),t}return e=i,(r=[{key:"init",value:function(t){t&&(t.addLayer(this.vectorLayer),Zn(Wn(i.prototype),"init",this).call(this,t))}},{key:"terminate",value:function(){this.map&&this.map.removeLayer(this.vectorLayer),Zn(Wn(i.prototype),"terminate",this).call(this)}},{key:"start",value:function(){this.map&&(Zn(Wn(i.prototype),"start",this).call(this),this.olEventsKeys=[].concat(Ln(this.olEventsKeys),[this.map.on("singleclick",this.onMapClick.bind(this)),this.map.on("moveend",this.onMoveEnd.bind(this))]))}},{key:"onMoveEnd",value:function(){this.updateTrajectories(),this.selectedVehicleId&&this.journeyId&&this.highlightTrajectory()}},{key:"onMapClick",value:function(t){var e=this;if(this.clickCallbacks.length){var r=An(this.getVehiclesAtCoordinate(t.coordinate),1)[0],n=[];if(r){var o=r.coordinate?new Ee.Point(r.coordinate):null;n.push(new De.a(qn({geometry:o},r))),n.length&&(this.selectedVehicleId=n[0].get("id"),this.journeyId=n[0].get("journeyIdentifier"),this.updateTrajectoryStations(this.selectedVehicleId).then((function(n){e.clickCallbacks.forEach((function(o){return o(qn(qn({},r),n),e,t)}))})))}else this.selectedVehicleId=null,this.vectorLayer.getSource().clear(),this.clickCallbacks.forEach((function(r){return r(null,e,t)}))}}},{key:"drawFullTrajectory",value:function(t,e,r){var n=/#ffffff/i.test(r)?"#ff0000":r,o=this.vectorLayer.getSource();if(o.clear(),t){var i=new Ee.MultiPoint(t),c=new De.a(i);c.setStyle(new xe.Style({zIndex:1,image:new xe.Circle({radius:5,fill:new xe.Fill({color:"#000000"})})}));var a=new De.a(i);a.setStyle(new xe.Style({zIndex:4,image:new xe.Circle({radius:4,fill:new xe.Fill({color:this.useDelayStyle?"#a0a0a0":n})})})),o.addFeatures([c,a])}var u=new De.a({geometry:e});u.setStyle([new xe.Style({zIndex:2,stroke:new xe.Stroke({color:"#000000",width:6})}),new xe.Style({zIndex:3,stroke:new xe.Stroke({color:this.useDelayStyle?"#a0a0a0":n,width:4})})]),o.addFeature(u)}},{key:"updateTrajectoryStations",value:function(t){var e=this;return Zn(Wn(i.prototype),"updateTrajectoryStations",this).call(this,t).then((function(t){return e.stationsCoords=[],t.stations.forEach((function(t){e.stationsCoords.push(Object(ee.transform)(t.coordinates,"EPSG:4326","EPSG:3857"))})),e.highlightTrajectory(),t}))}},{key:"highlightTrajectory",value:function(){var t=this;this.api.fetchTrajectoryById(this.getParams({id:this.journeyId,time:Tr(new Date)})).then((function(e){var r=e.p,n=e.t,o=e.c,i=[];r.forEach((function(t){t.forEach((function(t){i.push([t.x,t.y])}))})),t.drawFullTrajectory(t.stationsCoords,new Ee.LineString(i),o?"#".concat(o):$e(n))})).catch((function(){t.vectorLayer.getSource().clear()}))}},{key:"getParams",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.map.getView().calculateExtent(),r=Object(_e.buffer)(e,Object(_e.getWidth)(e)/10).join(","),n=this.map.getView().getZoom();return Zn(Wn(i.prototype),"getParams",this).call(this,qn(qn({},t),{},{bbox:r,s:n<10?1:0,z:n}))}},{key:"defaultStyle",value:function(t){var e=this.map.getView().getZoom();return Zn(Wn(i.prototype),"defaultStyle",this).call(this,t,e)}},{key:"clone",value:function(t){return new i(qn(qn({},this.options),t))}}])&&Bn(e.prototype,r),n&&Bn(e,n),i}(In(Sr)),Jn=r(19),Qn=r.n(Jn);function Yn(t){return(Yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function to(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Xn(Object(r),!0).forEach((function(e){eo(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function eo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ro(t,e,r){return(ro="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ao(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function no(t,e){return(no=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function oo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ao(t);if(e){var o=ao(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return io(this,r)}}function io(t,e){return!e||"object"!==Yn(e)&&"function"!=typeof e?co(t):e}function co(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ao(t){return(ao=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function uo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function so(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function lo(t,e,r){return e&&so(t.prototype,e),r&&so(t,r),t}var fo=function(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&no(t,e)}(r,t);var e=oo(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return uo(this,r),(t=e.call(this,to({},n))).debug=n.debug,t.mode=n.mode||gn.TOPOGRAPHIC,t.useDynamicIconScale=t.mode===gn.SCHEMATIC,t.trajectories=[],t.refreshTimeInMs=1e3/30,t.onMessage=t.onMessage.bind(co(t)),t.onDeleteMessage=t.onDeleteMessage.bind(co(t)),t.api=n.api||new On(n),t.format=new Kt.a,t.dfltIconScale=.6,t.dfltIconHighlightScale=.8,t.minIconScale=.75*t.dfltIconScale,t}return lo(r,[{key:"init",value:function(t){ro(ao(r.prototype),"init",this).call(this,t),this.api.subscribeTrajectory(this.mode,this.onMessage),this.api.subscribeDeletedVehicles(this.mode,this.onDeleteMessage)}},{key:"terminate",value:function(){this.api.unsubscribeTrajectory(),this.api.unsubscribeDeletedVehicles(),ro(ao(r.prototype),"terminate",this).call(this)}},{key:"setMode",value:function(t){this.mode=t,this.useDynamicIconScale=this.mode===gn.SCHEMATIC,this.api.subscribeTrajectory(this.mode,this.onMessage),this.api.subscribeDeletedVehicles(this.mode,this.onDeleteMessage)}},{key:"getIconScaleFromRes",value:function(t){var e=this.dfltIconScale;if(!this.useDynamicIconScale)return e;if(t>this.resZoom11){var r=this.resZoom11/t;e=r<this.minIconScale?this.minIconScale:r}else t<this.resZoom112&&(e=this.resZoom12/t);return parseFloat(e.toFixed(1))}},{key:"onMessage",value:function(t){if(t.content){var e=this.format.readFeature(t.content);if(e.set("timeOffset",Date.now()-t.timestamp),e.get("time_since_update")>=0){if(this.debug&&this.mode===gn.TOPOGRAPHIC){var r=new Qn.a(e.get("raw_coordinates"));r.transform("EPSG:4326",this.map.getView().getProjection()),e.setGeometry(r)}this.addTrajectory(e.get("train_id"),e.getProperties(),!e.get("line"))}}}},{key:"onDeleteMessage",value:function(t){t.content&&this.removeTrajectoryByAttribute("train_id",t.content)}},{key:"addTrajectory",value:function(t,e,r){var n=this.trajectories.findIndex((function(e){return e.train_id===t})),o=e.time_intervals,i=to(to({},e),{},{id:t,timeIntervals:o});r?(this.trajectories.unshift(i),-1!==n&&this.tracker.trajectories.splice(n+1,1)):(this.trajectories.push(i),-1!==n&&this.tracker.trajectories.splice(n,1)),this.updateTrajectories()}},{key:"removeTrajectory",value:function(t){for(var e=0,r=this.trajectories.length;e<r;e+=1)if(this.trajectories[e].id===t){this.trajectories.splice(e,1);break}}},{key:"removeTrajectoryByAttribute",value:function(t,e){for(var r=0,n=this.trajectories.length;r<n;r+=1)if(this.trajectories[r][t]===e){this.removeTrajectory(this.trajectories[r].id);break}}},{key:"updateTrajectories",value:function(){this.tracker.setTrajectories(this.trajectories)}},{key:"getRefreshTimeInMs",value:function(){return this.refreshTimeInMs}}]),r}(t)};function po(t){return(po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yo(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ho(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?yo(Object(r),!0).forEach((function(e){bo(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):yo(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function bo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function vo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function go(t,e,r){return(go="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Po(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function Oo(t,e){return(Oo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function jo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Po(t);if(e){var o=Po(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return wo(this,r)}}function wo(t,e){return!e||"object"!==po(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Po(t){return(Po=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var So=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Oo(t,e)}(i,t);var e,r,n,o=jo(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return vo(this,i),(t=o.call(this,ho({},e))).resZoom11=null,t.resZoom12=null,t}return e=i,(r=[{key:"init",value:function(t){var e=this;go(Po(i.prototype),"init",this).call(this,t),this.map&&(this.resZoom11=t.getView().getResolutionForZoom(11),this.resZoom12=t.getView().getResolutionForZoom(12),this.iconScale=this.getIconScaleFromRes(t.getView().getResolution()),this.olListenersKeys.push(t.getView().on("change:resolution",(function(t){var r=t.target;e.iconScale=e.getIconScaleFromRes(r.getResolution())}))))}},{key:"clone",value:function(t){return new i(ho(ho({},this.options),t))}}])&&mo(e.prototype,r),n&&mo(e,n),i}(fo(Sr));function ko(t){return(ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function To(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ro(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?To(Object(r),!0).forEach((function(e){Co(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):To(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Co(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Do(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Eo(t,e,r){return(Eo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ao(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function xo(t,e){return(xo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Io(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ao(t);if(e){var o=Ao(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Mo(this,r)}}function Mo(t,e){return!e||"object"!==ko(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ao(t){return(Ao=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Lo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xo(t,e)}(i,t);var e,r,n,o=Io(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Do(this,i),(t=o.call(this,e)).hitTolerance=e.hitTolerance||5,t}return e=i,(r=[{key:"getFeatureInfoAtCoordinate",value:function(t){var e=this,r=[];if(this.map){var n=this.map.getPixelFromCoordinate(t);r=this.map.getFeaturesAtPixel(n,{layerFilter:function(t){return t===e.olLayer},hitTolerance:this.hitTolerance})}return Promise.resolve({features:r,layer:this,coordinate:t})}},{key:"init",value:function(t){var e=this;Eo(Ao(i.prototype),"init",this).call(this,t),this.map&&(this.singleClickRef=this.map.on("singleclick",(function(t){e.clickCallbacks.length&&e.getFeatureInfoAtCoordinate(t.coordinate).then((function(t){return e.callClickCallbacks(t.features,t.layer,t.coordinate)})).catch((function(){return e.callClickCallbacks([],e,t.coordinate)}))})))}},{key:"callClickCallbacks",value:function(t,e,r){this.clickCallbacks.forEach((function(n){return n(t,e,r)}))}},{key:"terminate",value:function(){Eo(Ao(i.prototype),"terminate",this).call(this),this.singleClickRef&&Object(c.unByKey)(this.singleClickRef)}},{key:"clone",value:function(t){return new i(Ro(Ro({},this.options),t))}}])&&_o(e.prototype,r),n&&_o(e,n),i}(E);function Vo(t){return("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Uo(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function Fo(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Uo(Object(r),!0).forEach((function(e){qo(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Uo(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function qo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function No(t,e){return(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ko(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Zo(t);if(e){var o=Zo(this).constructor;Reflect.construct(n,arguments,o)}else n.apply(this,arguments);return Bo(this,r)}}function Bo(t,e){return!e||"object"!==Vo(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Zo(t){return(Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function zo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Go(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ho(t,e,r){return e&&Go(t.prototype,e),r&&Go(t,r),t}function Wo(t){return("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Qo(t,e){return(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Yo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ti(t);if(e){var o=ti(this).constructor;Reflect.construct(n,arguments,o)}else n.apply(this,arguments);return Xo(this,r)}}function Xo(t,e){return!e||"object"!==Wo(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ti(t){return(Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}ei=Z;var ei;function ri(t){return(ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ni(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function oi(t,e,r){return(oi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=si(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function ii(t,e){return(ii=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ci(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=si(t);if(e){var o=si(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return ai(this,r)}}function ai(t,e){return!e||"object"!==ri(e)&&"function"!=typeof e?ui(t):e}function ui(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function si(t){return(si=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var li=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ii(t,e)}(i,t);var e,r,n,o=ci(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).render=e.render.bind(ui(e)),e}return e=i,(r=[{key:"activate",value:function(){oi(si(i.prototype),"activate",this).call(this),this.map&&(this.map.on("sourcedata",this.render),this.map.on("styledata",this.render),this.map.on("idle",this.render))}},{key:"deactivate",value:function(){this.map&&(this.map.off("sourcedata",this.render),this.map.off("styledata",this.render),this.map.off("idle",this.render)),oi(si(i.prototype),"deactivate",this).call(this)}},{key:"getCopyrights",value:function(){return ce(this.map)}}])&&ni(e.prototype,r),n&&ni(e,n),i}(ht(Z));function fi(t){return("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function yi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?pi(Object(r),!0).forEach((function(e){hi(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):pi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function hi(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function bi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function vi(t,e,r){return("undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==Oi(t););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function mi(t,e){return(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function di(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Oi(t);if(e){var o=Oi(this).constructor;Reflect.construct(n,arguments,o)}else n.apply(this,arguments);return gi(this,r)}}function gi(t,e){return!e||"object"!==fi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Oi(t){return(Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}nt(re.Map);function ji(t){return function(t){if(Array.isArray(t))return wi(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return wi(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wi(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wi(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Pi=function(t){var e=t.getBounds().toArray(),r=[].concat(ji(Object(ee.fromLonLat)(e[0])),ji(Object(ee.fromLonLat)(e[1]))),n=t.getCanvas(),o=n.width,i=n.height,c=Object(_e.getWidth)(r)/o,a=Object(_e.getHeight)(r)/i;return Math.max(c,a)},Si=function(t){var e=t.getBounds().toArray();return[[e[0][0],e[1][1]],ji(e[1]),[e[1][0],e[0][1]],ji(e[0])]};function ki(t){return(ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ti(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var c,a=t[Symbol.iterator]();!(n=(c=a.next()).done)&&(r.push(c.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Ri(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ri(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ri(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ci(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Di(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ci(Object(r),!0).forEach((function(e){_i(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ci(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function _i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ei(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ii(t,e,r){return(Ii="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ui(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function Mi(t,e){return(Mi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ai(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ui(t);if(e){var o=Ui(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Li(this,r)}}function Li(t,e){return!e||"object"!==ki(e)&&"function"!=typeof e?Vi(t):e}function Vi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ui(t){return(Ui=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Fi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mi(t,e)}(i,t);var e,r,n,o=Ai(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ei(this,i),(t=o.call(this,Di({},e))).onMapZoomEnd=t.onMapZoomEnd.bind(Vi(t)),t.onMapMouseMove=t.onMapMouseMove.bind(Vi(t)),t}return e=i,(r=[{key:"updateIconScale",value:function(t){this.tracker.setIconScale(t.width/t.clientWidth)}},{key:"init",value:function(t){var e=this;if(t){var r=t.getCanvas(),n=r.width/r.clientWidth;t.on("resize",this.updateIconScale.bind(this,r)),Ii(Ui(i.prototype),"init",this).call(this,t,{width:r.width,height:r.height,iconScale:n,getPixelFromCoordinate:function(t){var r=window.devicePixelRatio||1,n=Ti(Object(ee.toLonLat)(t),2),o=n[0],i=n[1],c=e.map.project({lng:o,lat:i});return[c.x*r,c.y*r]}})}}},{key:"terminate",value:function(){return this.map&&this.map.off("resize",this.updateIconScale),Ii(Ui(i.prototype),"terminate",this).call(this)}},{key:"setCurrTime",value:function(t){var e=this.map.getCanvas();Ii(Ui(i.prototype),"setCurrTime",this).call(this,t,[e.width,e.height],Pi(this.map),!this.map.isMoving()&&!this.map.isRotating()&&!this.map.isZooming())}},{key:"start",value:function(){var t=this.map.getCanvas();Ii(Ui(i.prototype),"start",this).call(this,[t.width,t.height],this.map.getZoom(),Pi(this.map)),this.map.on("zoomend",this.onMapZoomEnd),this.isHoverActive&&this.map.on("mousemove",this.onMapMouseMove)}},{key:"stop",value:function(){Ii(Ui(i.prototype),"stop",this).call(this),this.map&&(this.map.off("zoomend",this.onMapZoomEnd),this.map.off("mousemove",this.onMapMouseMove))}},{key:"getVehiclesAtCoordinate",value:function(t){var e=Pi(this.map);return Ii(Ui(i.prototype),"getVehiclesAtCoordinate",this).call(this,t,e)}},{key:"onMapZoomEnd",value:function(){this.startUpdateTime(this.map.getZoom())}},{key:"onMapMouseMove",value:function(t){if(this.map.isMoving()||this.map.isRotating()||this.map.isZooming()||!this.isHoverActive)this.map.getContainer().style.cursor="auto";else{var e=Ti(this.getVehiclesAtCoordinate(Object(ee.fromLonLat)([t.lngLat.lng,t.lngLat.lat])),1)[0];this.map.getContainer().style.cursor=e?"pointer":"auto",this.tracker.setHoverVehicleId(e&&e.id)}}}])&&xi(e.prototype,r),n&&xi(e,n),i}(lr(O));function qi(t){return(qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ni(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ki(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ni(Object(r),!0).forEach((function(e){Bi(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ni(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Bi(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Zi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Gi(t,e,r){return(Gi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Qi(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function Hi(t,e){return(Hi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Wi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Qi(t);if(e){var o=Qi(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return $i(this,r)}}function $i(t,e){return!e||"object"!==qi(e)&&"function"!=typeof e?Ji(t):e}function Ji(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Qi(t){return(Qi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Yi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Hi(t,e)}(i,t);var e,r,n,o=Wi(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Zi(this,i),(t=o.call(this,Ki({},e))).onZoomEnd=t.onZoomEnd.bind(Ji(t)),t.onMove=t.onMove.bind(Ji(t)),t.onMoveEnd=t.onMoveEnd.bind(Ji(t)),t}return e=i,(r=[{key:"init",value:function(t,e){if(Gi(Qi(i.prototype),"init",this).call(this,t),this.map){this.iconScale=this.getIconScaleFromRes(Pi(this.map)),this.map.on("zoomend",this.onZoomEnd),this.map.on("move",this.onMove),this.map.on("moveend",this.onMoveEnd);var r=this.map.getCanvas(),n=r.width,o=r.height;this.tracker.canvas.width=n,this.tracker.canvas.height=o,this.map.addSource("canvas-source",{type:"canvas",canvas:this.tracker.canvas,coordinates:Si(this.map),animate:!0}),this.map.addLayer({id:"canvas-layer",type:"raster",source:"canvas-source",paint:{"raster-opacity":1,"raster-fade-duration":0}},e)}}},{key:"terminate",value:function(){this.map&&(this.map.off("zoomend",this.onZoomEnd),this.map.off("move",this.onMove),this.map.off("moveend",this.onMoveEnd)),Gi(Qi(i.prototype),"terminate",this).call(this)}},{key:"onMove",value:function(){this.map.getSource("canvas-source").setCoordinates(Si(this.map));var t=this.map.getCanvas(),e=t.width,r=t.height;this.tracker.renderTrajectories(this.currTime,[e,r],Pi(this.map))}},{key:"onMoveEnd",value:function(){this.updateTrajectories()}},{key:"onZoomEnd",value:function(){this.iconScale=this.getIconScaleFromRes(Pi(this.map))}}])&&zi(e.prototype,r),n&&zi(e,n),i}(fo(Fi));function Xi(t){return(Xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tc(t){return function(t){if(Array.isArray(t))return nc(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||rc(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ec(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var c,a=t[Symbol.iterator]();!(n=(c=a.next()).done)&&(r.push(c.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}(t,e)||rc(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rc(t,e){if(t){if("string"==typeof t)return nc(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?nc(t,e):void 0}}function nc(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function oc(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ic(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?oc(Object(r),!0).forEach((function(e){cc(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):oc(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function cc(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ac(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function uc(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function sc(t,e,r){return(sc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=hc(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function lc(t,e){return(lc=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function fc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=hc(t);if(e){var o=hc(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return pc(this,r)}}function pc(t,e){return!e||"object"!==Xi(e)&&"function"!=typeof e?yc(t):e}function yc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hc(t){return(hc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var bc={mapbox:{TrajservLayer:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lc(t,e)}(i,t);var e,r,n,o=fc(i);function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ac(this,i),(t=o.call(this,ic({},e))).onMapClick=t.onMapClick.bind(yc(t)),t.onMove=t.onMove.bind(yc(t)),t.onMoveEnd=t.onMoveEnd.bind(yc(t)),t.onVisibilityChange=t.onVisibilityChange.bind(yc(t)),t}return e=i,(r=[{key:"init",value:function(t,e){if(t){sc(hc(i.prototype),"init",this).call(this,t);var r=t.getCanvas(),n=r.width,o=r.height;this.tracker.canvas.width=n,this.tracker.canvas.height=o;var c={type:"canvas",canvas:this.tracker.canvas,coordinates:Si(t),animate:!0,attribution:this.copyrights};this.beforeId=e,this.layer={id:this.key,type:"raster",source:this.key,layout:{visibility:this.visible?"visible":"none"},paint:{"raster-opacity":1,"raster-fade-duration":0,"raster-resampling":"nearest"}},t.addSource(this.key,c),t.addLayer(this.layer,this.beforeId),this.listeners=[this.on("change:visible",this.onVisibilityChange)]}}},{key:"terminate",value:function(){this.map&&(this.listeners.forEach((function(t){Object(c.unByKey)(t)})),this.map.removeLayer(this.key),this.map.removeSource(this.key)),sc(hc(i.prototype),"terminate",this).call(this)}},{key:"start",value:function(){this.map&&(sc(hc(i.prototype),"start",this).call(this),this.map.on("click",this.onMapClick),this.map.on("move",this.onMove),this.map.on("moveend",this.onMoveEnd))}},{key:"stop",value:function(){this.map&&(this.map.off("click",this.onClick),this.map.off("move",this.onMove),this.map.off("moveend",this.onMoveEnd)),sc(hc(i.prototype),"stop",this).call(this)}},{key:"onVisibilityChange",value:function(){this.visible&&!this.map.getLayer(this.key)?this.map.addLayer(this.layer,this.beforeId):this.map.getLayer(this.key)&&this.map.removeLayer(this.key)}},{key:"onMove",value:function(){this.map.getSource(this.key).setCoordinates(Si(this.map));var t=this.map.getCanvas(),e=t.width,r=t.height;this.tracker.renderTrajectories(this.currTime,[e,r],Pi(this.map))}},{key:"onMoveEnd",value:function(){this.updateTrajectories(),this.selectedVehicleId&&this.journeyId&&this.highlightTrajectory()}},{key:"onMapClick",value:function(t){var e=this;if(this.clickCallbacks.length){var r=ec(this.getVehiclesAtCoordinate(Object(ee.fromLonLat)([t.lngLat.lng,t.lngLat.lat])),1)[0];r?(this.selectedVehicleId=r.id,this.journeyId=r.journeyIdentifier,this.updateTrajectoryStations(this.selectedVehicleId).then((function(n){e.stationsCoords=[],n.stations.forEach((function(t){e.stationsCoords.push(Object(ee.fromLonLat)(t.coordinates))})),e.clickCallbacks.forEach((function(o){return o(ic(ic({},r),n),e,t)}))}))):(this.selectedVehicleId=null,this.clickCallbacks.forEach((function(r){return r(null,e,t)})))}}},{key:"getParams",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.map.getBounds().toArray(),r=Object(ee.fromLonLat)(e[0]),n=Object(ee.fromLonLat)(e[1]),o=[].concat(tc(r),tc(n)),c=Object(_e.buffer)(o,Object(_e.getWidth)(o)/10).join(","),a=this.map.getZoom();return sc(hc(i.prototype),"getParams",this).call(this,ic(ic({},t),{},{bbox:c,s:a<10?1:0,z:a}))}},{key:"defaultStyle",value:function(t){var e=this.map.getZoom();return sc(hc(i.prototype),"defaultStyle",this).call(this,t,e)}},{key:"drawFullTrajectory",value:function(t,e,r){console.log("to be implemented")}},{key:"highlightTrajectory",value:function(t){var e=this;this.api.fetchTrajectoryById({id:t,time:Tr(new Date)}).catch((function(){e.map.getLayer("highlight-trajectory")&&e.map.removeLayer("highlight-trajectory")}))}}])&&uc(e.prototype,r),n&&uc(e,n),i}(In(Fi)),TralisLayer:Yi},ol:{Map:qt,Layer:E,WMSLayer:te,MapboxLayer:Re,TrajservLayer:$n,TralisLayer:So,VectorLayer:Lo}};e.default=bc}])}));
//# sourceMappingURL=index.js.map