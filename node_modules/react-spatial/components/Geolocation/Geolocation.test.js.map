{"version":3,"file":"Geolocation.test.js","sources":["../../../src/components/Geolocation/Geolocation.test.js"],"sourcesContent":["import React from 'react';\nimport renderer from 'react-test-renderer';\nimport { configure, mount, shallow } from 'enzyme';\nimport Adapter from 'enzyme-adapter-react-16';\n\nimport 'jest-canvas-mock';\nimport Map from 'ol/Map';\nimport View from 'ol/View';\nimport MapEvent from 'ol/MapEvent';\nimport Geolocation from './Geolocation';\n\nconfigure({ adapter: new Adapter() });\n\nconst geolocationBackup = global.navigator.geolocation;\n\nconst mockGeolocation = () => {\n  const mock = {\n    clearWatch: jest.fn(),\n    getCurrentPosition: jest.fn(),\n    watchPosition: (onSuccess) => {\n      onSuccess({\n        coords: {\n          latitude: 47.9913611,\n          longitude: 7.84868,\n          accuracy: 55,\n        },\n        timestamp: 1552660077044,\n      });\n    },\n  };\n\n  global.navigator.geolocation = mock;\n};\n\nconst mockMissingGeolocation = () => {\n  delete global.navigator.geolocation;\n};\n\nconst restoreGeolocation = () => {\n  global.navigator.geolocation = geolocationBackup;\n};\n\ndescribe('Geolocation', () => {\n  let map;\n\n  beforeEach(() => {\n    const target = document.createElement('div');\n    const { style } = target;\n    style.position = 'absolute';\n    style.left = '-1000px';\n    style.top = '-1000px';\n    style.width = '100px';\n    style.height = '100px';\n    document.body.appendChild(target);\n\n    map = new Map({\n      target,\n      view: new View({\n        center: [0, 0],\n        resolutions: [1],\n        zoom: 0,\n      }),\n    });\n    map.renderSync();\n  });\n\n  afterEach(() => {\n    const target = map.getTarget();\n    map.setTarget(null);\n    if (target && target.parentNode) {\n      target.parentNode.removeChild(target);\n    }\n    map.dispose();\n  });\n\n  describe('should match snapshot', () => {\n    test('minimum props', () => {\n      const component = renderer.create(<Geolocation map={map} />);\n      const tree = component.toJSON();\n      expect(tree).toMatchSnapshot();\n    });\n\n    test('with title', () => {\n      const component = renderer.create(\n        <Geolocation map={map} title=\"Lokalisieren\" />,\n      );\n      const tree = component.toJSON();\n      expect(tree).toMatchSnapshot();\n    });\n\n    test('with class name', () => {\n      const component = renderer.create(\n        <Geolocation map={map} className=\"my-class-name\" />,\n      );\n      const tree = component.toJSON();\n      expect(tree).toMatchSnapshot();\n    });\n  });\n\n  test('should use children', () => {\n    mockGeolocation();\n\n    const wrapper = mount(<Geolocation map={map}>test</Geolocation>);\n\n    const text = wrapper.find('.rs-geolocation').first().text();\n\n    expect(text).toBe('test');\n\n    restoreGeolocation();\n  });\n\n  describe('button classes', () => {\n    test('class should be active', () => {\n      mockGeolocation();\n\n      const wrapper = mount(<Geolocation map={map} />);\n      const basic = wrapper.getDOMNode();\n\n      wrapper.find('.rs-geolocation').first().simulate('click');\n\n      expect(basic.className).toBe('rs-geolocation rs-active');\n\n      restoreGeolocation();\n    });\n\n    test('class should not be active', () => {\n      mockGeolocation();\n\n      const wrapper = mount(<Geolocation map={map} />);\n      const basic = wrapper.getDOMNode();\n\n      wrapper\n        .find('.rs-geolocation')\n        .first()\n        .simulate('click')\n        .simulate('click');\n\n      expect(basic.className).toBe('rs-geolocation ');\n\n      restoreGeolocation();\n    });\n  });\n\n  test(`highlight on first toggle`, () => {\n    mockGeolocation();\n\n    const component = shallow(<Geolocation map={map} />);\n    const instance = component.instance();\n    const spy = jest.spyOn(instance, 'highlight');\n    instance.toggle();\n    expect(spy).toHaveBeenCalled();\n\n    restoreGeolocation();\n  });\n\n  test(`error function should be called`, () => {\n    mockMissingGeolocation();\n\n    class ErrorHandler {\n      static onError() {}\n    }\n\n    const spy = jest.spyOn(ErrorHandler, 'onError');\n\n    const wrapper = mount(\n      <Geolocation map={map} onError={() => ErrorHandler.onError()} />,\n    );\n\n    wrapper.find('.rs-geolocation').first().simulate('click');\n\n    expect(spy).toHaveBeenCalled();\n\n    restoreGeolocation();\n  });\n\n  describe('map centering', () => {\n    test('centers map', () => {\n      mockGeolocation();\n\n      const center1 = [742952.8821531708, 6330118.608483334];\n      map.getView().setCenter(center1);\n\n      const component = shallow(<Geolocation map={map} />);\n      component.instance().toggle();\n\n      const center2 = map.getView().getCenter();\n      expect(center1).not.toEqual(center2);\n\n      restoreGeolocation();\n    });\n\n    test('no center after drag', () => {\n      mockGeolocation();\n\n      const center1 = [742952.8821531708, 6330118.608483334];\n      map.getView().setCenter(center1);\n\n      const component = shallow(<Geolocation map={map} noCenterAfterDrag />);\n      map.dispatchEvent(new MapEvent('pointerdrag', map));\n      component.instance().toggle();\n\n      const center2 = map.getView().getCenter();\n      expect(center1).toEqual(center2);\n\n      restoreGeolocation();\n    });\n  });\n\n  test('custom style function', () => {\n    mockGeolocation();\n\n    const styleFunc = jest.fn();\n\n    const component = shallow(\n      <Geolocation map={map} colorOrStyleFunc={styleFunc} />,\n    );\n    const instance = component.instance();\n    instance.toggle();\n    const style = instance.layer.getSource().getFeatures()[0].getStyle();\n\n    expect(style).toBe(styleFunc);\n\n    restoreGeolocation();\n  });\n});\n"],"names":["const","let"],"mappings":"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"}