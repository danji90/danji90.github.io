{"version":3,"file":"Geolocation.js","sources":["../../../src/components/Geolocation/Geolocation.js"],"sourcesContent":["import React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\n\nimport OLMap from 'ol/Map';\nimport { transform } from 'ol/proj';\nimport Point from 'ol/geom/Point';\nimport Feature from 'ol/Feature';\n\nimport Style from 'ol/style/Style';\nimport Circle from 'ol/style/Circle';\nimport Fill from 'ol/style/Fill';\nimport Stroke from 'ol/style/Stroke';\n\nimport VectorLayer from 'ol/layer/Vector';\nimport VectorSource from 'ol/source/Vector';\n\nimport { FaRegDotCircle } from 'react-icons/fa';\n\nconst propTypes = {\n  /**\n   * CSS class of the button.\n   */\n  className: PropTypes.string,\n\n  /**\n   *  Children content of the Geolocation button.\n   */\n  children: PropTypes.node,\n\n  /**\n   * An [ol/map](https://openlayers.org/en/latest/apidoc/module-ol_Map-Map.html).\n   */\n  map: PropTypes.instanceOf(OLMap).isRequired,\n\n  /**\n   * Function triggered when geolocating is not successful.\n   */\n  onError: PropTypes.func,\n\n  /**\n   * If true, the map is not centered after it has been dragged once.\n   */\n  noCenterAfterDrag: PropTypes.bool,\n\n  /**\n   * If true, the map will constantly recenter to the current Position\n   */\n  alwaysRecenterToPosition: PropTypes.bool,\n\n  /**\n   * Color (Number array with rgb values) or style function.\n   * If a color is given, the style is animated.\n   */\n  colorOrStyleFunc: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.number),\n    PropTypes.func,\n  ]),\n};\n\nconst defaultProps = {\n  className: 'rs-geolocation',\n  children: <FaRegDotCircle focusable={false} />,\n  onError: () => {},\n  noCenterAfterDrag: false,\n  alwaysRecenterToPosition: true,\n  colorOrStyleFunc: [235, 0, 0],\n};\n\n/**\n * The GeoLocation component creates a button to display the current device's location on an\n * [ol/map](https://openlayers.org/en/latest/apidoc/module-ol_Map-Map.html).\n */\nclass Geolocation extends PureComponent {\n  constructor(props) {\n    super(props);\n    const { map, noCenterAfterDrag } = this.props;\n\n    this.layer = new VectorLayer({\n      source: new VectorSource(),\n    });\n\n    this.isRecenteringToPosition = true;\n    if (noCenterAfterDrag) {\n      map.on('pointerdrag', () => {\n        this.isRecenteringToPosition = false;\n      });\n    }\n\n    this.state = {\n      active: false,\n    };\n    this.point = undefined;\n  }\n\n  componentWillUnmount() {\n    this.deactivate();\n  }\n\n  toggle() {\n    const { active } = this.state;\n    const { onError } = this.props;\n    const geolocation = 'geolocation' in navigator;\n\n    if (!geolocation) {\n      onError();\n    } else if (!active) {\n      this.activate();\n    } else {\n      this.deactivate();\n    }\n  }\n\n  error() {\n    const { onError } = this.props;\n\n    this.deactivate();\n    onError();\n  }\n\n  deactivate() {\n    const { noCenterAfterDrag } = this.props;\n    window.clearInterval(this.interval);\n    this.layer.setMap(null);\n    navigator.geolocation.clearWatch(this.watch);\n\n    if (!noCenterAfterDrag) {\n      this.isRecenteringToPosition = true;\n    }\n\n    this.setState({\n      active: false,\n    });\n    this.point = undefined;\n  }\n\n  activate() {\n    const { map } = this.props;\n\n    this.projection = map.getView().getProjection().getCode();\n    this.point = new Point([0, 0]);\n    this.highlight();\n    this.layer.setMap(map);\n    this.setState({ active: true });\n\n    this.watch = navigator.geolocation.watchPosition(\n      this.update.bind(this),\n      this.error.bind(this),\n      {\n        enableHighAccuracy: true,\n      },\n    );\n  }\n\n  update({ coords: { latitude, longitude } }) {\n    const { map, alwaysRecenterToPosition } = this.props;\n\n    const position = transform(\n      [longitude, latitude],\n      'EPSG:4326',\n      this.projection,\n    );\n    this.point.setCoordinates(position);\n\n    if (this.isRecenteringToPosition) {\n      map.getView().setCenter(position);\n      if (!alwaysRecenterToPosition) {\n        this.isRecenteringToPosition = false;\n      }\n    }\n  }\n\n  highlight() {\n    const { colorOrStyleFunc } = this.props;\n    const feature = new Feature({\n      geometry: this.point,\n    });\n\n    if (Array.isArray(colorOrStyleFunc)) {\n      const color = colorOrStyleFunc;\n\n      let decrease = true;\n      let opacity = 0.5;\n      let rotation = 0;\n\n      window.clearInterval(this.interval);\n      this.interval = window.setInterval(() => {\n        rotation += 0.03;\n        decrease = opacity < 0.1 ? false : decrease;\n        decrease = opacity > 0.5 ? true : decrease;\n        opacity += decrease ? -0.03 : 0.03;\n        if (feature) {\n          feature.changed();\n        }\n      }, 50);\n\n      feature.setStyle(() => {\n        const circleStyle = new Style({\n          image: new Circle({\n            radius: 20,\n            rotation,\n            fill: new Fill({\n              color: 'rgba(255, 255, 255, 0.01)',\n            }),\n            stroke: new Stroke({\n              lineDash: [30, 10],\n              width: 6,\n              color: `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${opacity})`,\n            }),\n          }),\n        });\n\n        circleStyle.getImage().setRotation(rotation);\n\n        return [\n          new Style({\n            image: new Circle({\n              radius: 10,\n              fill: new Fill({\n                color: `rgba(${color[0]}, ${color[1]}, ${color[2]}, 0.5)`,\n              }),\n            }),\n          }),\n          circleStyle,\n        ];\n      });\n    } else {\n      feature.setStyle(colorOrStyleFunc);\n    }\n\n    this.layer.getSource().clear();\n    this.layer.getSource().addFeature(feature);\n  }\n\n  render() {\n    const { children, className } = this.props;\n    // Remove component props from other HTML props.\n    const other = Object.entries(this.props).reduce((props, [key, value]) => {\n      return propTypes[key] ? props : { ...props, [key]: value };\n    }, {});\n    const { active } = this.state;\n\n    return (\n      <div\n        role=\"button\"\n        tabIndex=\"0\"\n        className={`${className} ${active ? 'rs-active' : ''}`}\n        onClick={() => this.toggle()}\n        onKeyPress={(e) => e.which === 13 && this.toggle()}\n        // eslint-disable-next-line react/jsx-props-no-spreading\n        {...other}\n      >\n        {children}\n      </div>\n    );\n  }\n}\n\nGeolocation.propTypes = propTypes;\nGeolocation.defaultProps = defaultProps;\n\nexport default Geolocation;\n"],"names":["const","super","this","let"],"mappings":"AAAA,OAAO,KAAK,IAAI,aAAa,QAAQ,OAAO,CAAC;AAC7C,OAAO,SAAS,MAAM,YAAY,CAAC;AACnC;AACA,OAAO,KAAK,MAAM,QAAQ,CAAC;AAC3B,SAAS,SAAS,QAAQ,SAAS,CAAC;AACpC,OAAO,KAAK,MAAM,eAAe,CAAC;AAClC,OAAO,OAAO,MAAM,YAAY,CAAC;AACjC;AACA,OAAO,KAAK,MAAM,gBAAgB,CAAC;AACnC,OAAO,MAAM,MAAM,iBAAiB,CAAC;AACrC,OAAO,IAAI,MAAM,eAAe,CAAC;AACjC,OAAO,MAAM,MAAM,iBAAiB,CAAC;AACrC;AACA,OAAO,WAAW,MAAM,iBAAiB,CAAC;AAC1C,OAAO,YAAY,MAAM,kBAAkB,CAAC;AAC5C;AACA,SAAS,cAAc,QAAQ,gBAAgB,CAAC;AAChD;AACAA,GAAK,CAAC,SAAS,GAAG;AAClB;AACA;AACA;AACA,EAAE,SAAS,EAAE,SAAS,CAAC,MAAM;AAC7B;AACA;AACA;AACA;AACA,EAAE,QAAQ,EAAE,SAAS,CAAC,IAAI;AAC1B;AACA;AACA;AACA;AACA,EAAE,GAAG,EAAE,SAAS,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,UAAU;AAC7C;AACA;AACA;AACA;AACA,EAAE,OAAO,EAAE,SAAS,CAAC,IAAI;AACzB;AACA;AACA;AACA;AACA,EAAE,iBAAiB,EAAE,SAAS,CAAC,IAAI;AACnC;AACA;AACA;AACA;AACA,EAAE,wBAAwB,EAAE,SAAS,CAAC,IAAI;AAC1C;AACA;AACA;AACA;AACA;AACA,EAAE,gBAAgB,EAAE,SAAS,CAAC,SAAS,CAAC;AACxC,IAAI,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC;AACvC,IAAI,SAAS,CAAC,IAAI,CAChB,CAAC,CAAC;AACJ,CAAC,CAAC;AACF;AACAA,GAAK,CAAC,YAAY,GAAG;AACrB,EAAE,SAAS,EAAE,gBAAgB;AAC7B,EAAE,QAAQ,EAAE,qBAAC,iBAAc,CAAC,WAAW,OAAM,CAAG;AAChD,EAAE,OAAO,WAAE,GAAM,EAAE;AACnB,EAAE,iBAAiB,EAAE,KAAK;AAC1B,EAAE,wBAAwB,EAAE,IAAI;AAChC,EAAE,gBAAgB,EAAE,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC;AAC/B,CAAC,CAAC;AACF;AACA;AACA;AACA;AACA;AACA,IAAM,WAAW,GAAsB;EACrC,oBAAW,CAAC,KAAK,EAAE;;AAAC;AACtB,IAAIC,kBAAK,OAAC,KAAK,CAAC,CAAC;AACjB,WAAoC,GAAG,IAAI,CAAC;IAAhC;IAAK,8CAAiC;AAClD;AACA,IAAI,IAAI,CAAC,KAAK,GAAG,IAAI,WAAW,CAAC;AACjC,MAAM,MAAM,EAAE,IAAI,YAAY,EAAE;AAChC,KAAK,CAAC,CAAC;AACP;AACA,IAAI,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC;AACxC,IAAI,IAAI,iBAAiB,EAAE;AAC3B,MAAM,GAAG,CAAC,EAAE,CAAC,aAAa,WAAE,GAAM;AAClC,QAAQC,MAAI,CAAC,uBAAuB,GAAG,KAAK,CAAC;AAC7C,OAAO,CAAC,CAAC;AACT,KAAK;AACL;AACA,IAAI,IAAI,CAAC,KAAK,GAAG;AACjB,MAAM,MAAM,EAAE,KAAK;AACnB,KAAK,CAAC;AACN,IAAI,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;AAC3B;;;;kDAAG;AACH;AACA,wBAAE,qDAAoB,GAAG;AACzB,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;AACtB,IAAG;AACH;AACA,wBAAE,yBAAM,GAAG;AACX,WAAoB,GAAG,IAAI,CAAC;IAAhB,wBAAsB;AAClC,aAAqB,GAAG,IAAI,CAAC;IAAjB,4BAAuB;AACnC,IAAIF,GAAK,CAAC,WAAW,GAAG,aAAa,IAAI,SAAS,CAAC;AACnD;AACA,IAAI,IAAI,CAAC,WAAW,EAAE;AACtB,MAAM,OAAO,EAAE,CAAC;AAChB,KAAK,MAAM,IAAI,CAAC,MAAM,EAAE;AACxB,MAAM,IAAI,CAAC,QAAQ,EAAE,CAAC;AACtB,KAAK,MAAM;AACX,MAAM,IAAI,CAAC,UAAU,EAAE,CAAC;AACxB,KAAK;AACL,IAAG;AACH;AACA,wBAAE,uBAAK,GAAG;AACV,WAAqB,GAAG,IAAI,CAAC;IAAjB,0BAAuB;AACnC;AACA,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;AACtB,IAAI,OAAO,EAAE,CAAC;AACd,IAAG;AACH;AACA,wBAAE,iCAAU,GAAG;AACf,WAA+B,GAAG,IAAI,CAAC;IAA3B,8CAAiC;AAC7C,IAAI,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AACxC,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AAC5B,IAAI,SAAS,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;AACjD;AACA,IAAI,IAAI,CAAC,iBAAiB,EAAE;AAC5B,MAAM,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC;AAC1C,KAAK;AACL;AACA,IAAI,IAAI,CAAC,QAAQ,CAAC;AAClB,MAAM,MAAM,EAAE,KAAK;AACnB,KAAK,CAAC,CAAC;AACP,IAAI,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC;AAC3B,IAAG;AACH;AACA,wBAAE,6BAAQ,GAAG;AACb,WAAiB,GAAG,IAAI,CAAC;IAAb,kBAAmB;AAC/B;AACA,IAAI,IAAI,CAAC,UAAU,GAAG,GAAG,CAAC,OAAO,EAAE,CAAC,aAAa,EAAE,CAAC,OAAO,EAAE,CAAC;AAC9D,IAAI,IAAI,CAAC,KAAK,GAAG,IAAI,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACnC,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;AACrB,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAC3B,IAAI,IAAI,CAAC,QAAQ,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC;AACpC;AACA,IAAI,IAAI,CAAC,KAAK,GAAG,SAAS,CAAC,WAAW,CAAC,aAAa;AACpD,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;AAC5B,MAAM,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC;AAC3B,MAAM;AACN,QAAQ,kBAAkB,EAAE,IAAI;AAChC,OAAQ;AACR,KAAK,CAAC;AACN,IAAG;AACH;AACA,wBAAE,yBAAM,IAAoC,EAAE,CAA3B;gCAAE;uCAAU;;AAAgB;AAC/C,aAA2C,GAAG,IAAI,CAAC;IAAvC;IAAK,8DAAwC;AACzD;AACA,IAAIA,GAAK,CAAC,QAAQ,GAAG,SAAS;AAC9B,MAAM,CAAC,SAAS,EAAE,QAAQ,CAAC;AAC3B,MAAM,WAAW;AACjB,MAAM,IAAI,CAAC,UAAW;AACtB,KAAK,CAAC;AACN,IAAI,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;AACxC;AACA,IAAI,IAAI,IAAI,CAAC,uBAAuB,EAAE;AACtC,MAAM,GAAG,CAAC,OAAO,EAAE,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;AACxC,MAAM,IAAI,CAAC,wBAAwB,EAAE;AACrC,QAAQ,IAAI,CAAC,uBAAuB,GAAG,KAAK,CAAC;AAC7C,OAAO;AACP,KAAK;AACL,IAAG;AACH;AACA,wBAAE,+BAAS,GAAG;AACd,WAA8B,GAAG,IAAI,CAAC;IAA1B,4CAAgC;AAC5C,IAAIA,GAAK,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC;AAChC,MAAM,QAAQ,EAAE,IAAI,CAAC,KAAK;AAC1B,KAAK,CAAC,CAAC;AACP;AACA,IAAI,IAAI,KAAK,CAAC,OAAO,CAAC,gBAAgB,CAAC,EAAE;AACzC,MAAMA,GAAK,CAAC,KAAK,GAAG,gBAAgB,CAAC;AACrC;AACA,MAAMG,GAAG,CAAC,QAAQ,GAAG,IAAI,CAAC;AAC1B,MAAMA,GAAG,CAAC,OAAO,GAAG,GAAG,CAAC;AACxB,MAAMA,GAAG,CAAC,QAAQ,GAAG,CAAC,CAAC;AACvB;AACA,MAAM,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AAC1C,MAAM,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,WAAW,UAAC,GAAM;AAC/C,QAAQ,QAAQ,IAAI,IAAI,CAAC;AACzB,QAAQ,QAAQ,GAAG,OAAO,GAAG,GAAG,GAAG,KAAK,GAAG,QAAQ,CAAC;AACpD,QAAQ,QAAQ,GAAG,OAAO,GAAG,GAAG,GAAG,IAAI,GAAG,QAAQ,CAAC;AACnD,QAAQ,OAAO,IAAI,QAAQ,GAAG,CAAC,IAAI,GAAG,IAAI,CAAC;AAC3C,QAAQ,IAAI,OAAO,EAAE;AACrB,UAAU,OAAO,CAAC,OAAO,EAAE,CAAC;AAC5B,SAAS;AACT,OAAO,EAAE,EAAE,CAAC,CAAC;AACb;AACA,MAAM,OAAO,CAAC,QAAQ,UAAC,GAAM;AAC7B,QAAQH,GAAK,CAAC,WAAW,GAAG,IAAI,KAAK,CAAC;AACtC,UAAU,KAAK,EAAE,IAAI,MAAM,CAAC;AAC5B,YAAY,MAAM,EAAE,EAAE;AACtB,sBAAY,QAAQ;AACpB,YAAY,IAAI,EAAE,IAAI,IAAI,CAAC;AAC3B,cAAc,KAAK,EAAE,2BAA2B;AAChD,aAAa,CAAC;AACd,YAAY,MAAM,EAAE,IAAI,MAAM,CAAC;AAC/B,cAAc,QAAQ,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC;AAChC,cAAc,KAAK,EAAE,CAAC;AACtB,cAAc,KAAK,EAAE,YAAQ,KAAK,CAAC,CAAC,EAAC,WAAK,KAAK,CAAC,CAAC,EAAC,WAAK,KAAK,CAAC,CAAC,EAAC,UAAK,OAAO,OAAG;AAC9E,aAAa,CAAC;AACd,WAAW,CAAC;AACZ,SAAS,CAAC,CAAC;AACX;AACA,QAAQ,WAAW,CAAC,QAAQ,EAAE,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;AACrD;AACA,QAAQ,OAAO;AACf,UAAU,IAAI,KAAK,CAAC;AACpB,YAAY,KAAK,EAAE,IAAI,MAAM,CAAC;AAC9B,cAAc,MAAM,EAAE,EAAE;AACxB,cAAc,IAAI,EAAE,IAAI,IAAI,CAAC;AAC7B,gBAAgB,KAAK,EAAE,YAAQ,KAAK,CAAC,CAAC,EAAC,WAAK,KAAK,CAAC,CAAC,EAAC,WAAK,KAAK,CAAC,CAAC,EAAC,YAAQ;AACzE,eAAe,CAAC;AAChB,aAAa,CAAC;AACd,WAAW,CAAC;AACZ,UAAU,WAAW,CACb,CAAC,CAAC;AACV,OAAO,CAAC,CAAC;AACT,KAAK,MAAM;AACX,MAAM,OAAO,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC;AACzC,KAAK;AACL;AACA,IAAI,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC,KAAK,EAAE,CAAC;AACnC,IAAI,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;AAC/C,IAAG;AACH;AACA,wBAAE,yBAAM,GAAG;;AAAC;AACZ,WAAiC,GAAG,IAAI,CAAC;IAA7B;IAAU,8BAAyB;AAC/C;AACA,IAAIA,GAAK,CAAC,KAAK,GAAG,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,MAAM,UAAC,CAAC,KAAK,KAAc,EAAK;;AAAhB;uBAAK;yBAAY;AAC9E,MAAM,OAAO,SAAS,CAAC,GAAG,CAAC,GAAG,KAAK,GAAG,kBAAK,KAAK,iBAAE,CAAC,GAAG,IAAG,aAAO,CAAC;AACjE,KAAK,EAAE,EAAE,CAAC,CAAC;AACX,aAAoB,GAAG,IAAI,CAAC;IAAhB,0BAAsB;AAClC;AACA,IAAI,OAAO;AACX,MAAM,sBAAC,uBAAG;AACV,UAAQ,MAAK,QAAQ,EACb,UAAS,GAAG,EACZ,YAAc,SAAS,UAAI,MAAM,GAAG,WAAW,GAAG,IAAK,EACvD,kBAAS,YAAME,MAAI,CAAC,MAAM,KAAG,EAC7B,qBAAY,CAAC,CAAC,WAAK,CAAC,CAAC,KAAK,KAAK,EAAE,IAAIA,MAAI,CAAC,MAAM,OAAG,EAE/C,OACL;AACP,QAAS,QAAS;AAClB,MAAM,CAAM;AACZ,KAAK,CAAC;AACN;;;EAtL0B,gBAuLzB;AACD;AACA,WAAW,CAAC,SAAS,GAAG,SAAS,CAAC;AAClC,WAAW,CAAC,YAAY,GAAG,YAAY,CAAC;AACxC;AACA,eAAe,WAAW,CAAC;"}