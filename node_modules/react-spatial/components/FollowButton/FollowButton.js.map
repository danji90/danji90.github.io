{"version":3,"file":"FollowButton.js","sources":["../../../src/components/FollowButton/FollowButton.js"],"sourcesContent":["import React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport { TrackerLayer } from 'mobility-toolbox-js/ol';\n\nconst propTypes = {\n  /**\n   * CSS class of the follow button.\n   */\n  className: PropTypes.string,\n\n  /**\n   * Title.\n   */\n  title: PropTypes.string,\n\n  /**\n   * Line info route identifer.\n   */\n  routeIdentifier: PropTypes.string.isRequired,\n\n  /**\n   * Button is active.\n   */\n  active: PropTypes.bool.isRequired,\n\n  /**\n   * Function triggered on button click.\n   */\n  onClick: PropTypes.func.isRequired,\n\n  /**\n   * Trackerlayer.\n   */\n  trackerLayer: PropTypes.instanceOf(TrackerLayer).isRequired,\n\n  /**\n   * Function to set the map center, Used to follow a train.\n   */\n  setCenter: PropTypes.func.isRequired,\n\n  /**\n   * Children content of the button.\n   */\n  children: PropTypes.element.isRequired,\n};\n\nconst defaultProps = {\n  className: 'rt-route-follow',\n  title: 'Follow',\n};\n\n/**\n * Button enables the follow of a selected train.\n */\nclass FollowButton extends PureComponent {\n  constructor() {\n    super();\n    this.onClick = this.onClick.bind(this);\n  }\n\n  componentDidUpdate(prevProps) {\n    const { routeIdentifier, active, trackerLayer, onClick } = this.props;\n\n    if (routeIdentifier !== prevProps.routeIdentifier) {\n      onClick(false);\n    }\n\n    if (active !== prevProps.active) {\n      if (active && trackerLayer) {\n        this.centerOnTrajectory(routeIdentifier);\n        this.updateInterval = window.setInterval(() => {\n          this.centerOnTrajectory(routeIdentifier);\n        }, 50);\n      } else {\n        clearInterval(this.updateInterval);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.updateInterval);\n  }\n\n  onClick() {\n    const { active, onClick } = this.props;\n    onClick(!active);\n  }\n\n  centerOnTrajectory(routeIdentifier) {\n    const { trackerLayer, setCenter } = this.props;\n\n    const [trajectory] = trackerLayer.getVehicle(\n      (r) => r.routeIdentifier === routeIdentifier,\n    );\n    const firstCoord = trajectory && trajectory.coordinate;\n    if (firstCoord) {\n      setCenter(firstCoord);\n    }\n  }\n\n  render() {\n    const { className, title, active, children } = this.props;\n\n    return (\n      <div\n        aria-label={title}\n        className={`${className}${active ? ' rt-active' : ''}`}\n        title={title}\n        onClick={this.onClick}\n        onKeyPress={(e) => e.which === 13 && this.onClick}\n        role=\"button\"\n        tabIndex={0}\n      >\n        {children}\n      </div>\n    );\n  }\n}\n\nFollowButton.propTypes = propTypes;\nFollowButton.defaultProps = defaultProps;\n\nexport default FollowButton;\n"],"names":["const","super","this"],"mappings":"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"}