{"version":3,"file":"CanvasSaveButton.js","sources":["../../../src/components/CanvasSaveButton/CanvasSaveButton.js"],"sourcesContent":["import React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport OLMap from 'ol/Map';\nimport { getTopLeft, getBottomRight } from 'ol/extent';\nimport NorthArrowSimple from '../../images/northArrow.url.svg';\nimport NorthArrowCircle from '../../images/northArrowCircle.url.svg';\n\nconst propTypes = {\n  /**\n   * Automatically download the image saved.\n   */\n  autoDownload: PropTypes.bool,\n\n  /**\n   * Children content of the button.\n   */\n  children: PropTypes.node,\n\n  /**\n   * Output format of the image.\n   */\n  format: PropTypes.oneOf(['image/jpeg', 'image/png']),\n\n  /** An  [ol/map](https://openlayers.org/en/latest/apidoc/module-ol_Map-Map.html). */\n  map: PropTypes.instanceOf(OLMap),\n\n  /**\n   * Extent for the export. If no extent is given, the whole map is exported.\n   */\n  extent: PropTypes.arrayOf(PropTypes.number),\n\n  /**\n   * Array of 4 [ol/Coordinate](https://openlayers.org/en/latest/apidoc/module-ol_coordinate.html#~Coordinate).\n   * If no coordinates and no extent are given, the whole map is exported.\n   * This property must be used to export rotated map.\n   * If you don't need to export rotated map the extent property can be used as well.\n   * If extent is specified, coordinates property is ignored.\n   */\n  coordinates: PropTypes.arrayOf(PropTypes.arrayOf(PropTypes.number)),\n\n  /**\n   * Scale the map for better quality. Possible values: 1, 2 or 3.\n   * WARNING: The tiled layer with a WMTS or XYZ source must provides an url\n   * for each scale in the config file.\n   */\n  scale: PropTypes.number,\n\n  /**\n   * Function called before the dowload process begins.\n   */\n  onSaveStart: PropTypes.func,\n\n  /**\n   * Function called after the dowload process ends.\n   *\n   * @param {object} error Error message the process fails.\n   */\n  onSaveEnd: PropTypes.func,\n\n  /**\n   * Extra data, such as copyright, north arrow configuration.\n   * All extra data is optional.\n   *\n   * Example 1:\n   *\n    {\n      copyright: {\n        text: 'Example copyright', // Copyright text or function\n        font: '10px Arial', // Font, default is '12px Arial'\n        fillStyle: 'blue', // Fill style, default is 'black'\n      },\n      northArrow,  // True if the north arrow\n                   // should be placed with default configuration\n                   // (default image, rotation=0, circled=False)\n    }\n   * Example 2:\n   *\n    {\n      northArrow: {\n        src: NorthArrowCustom,\n        width: 60, // Width in px, default is 80\n        height: 100, // Height in px, default is 80\n        rotation: 25, // Absolute rotation in degrees as number or function\n\n      }\n    }\n   * Example 3:\n   *\n    {\n      copyright: {\n        text: () => { // Copyright as function\n          return this.copyright;\n        },\n      },\n      northArrow: {\n        rotation: () => { // Rotation as function\n          return NorthArrow.radToDeg(this.map.getView().getRotation());\n        },\n        circled, // Display circle around the north arrow (Does not work for custom src)\n      },\n    }\n   */\n  extraData: PropTypes.object,\n};\n\nconst defaultProps = {\n  autoDownload: true,\n  children: null,\n  map: null,\n  format: 'image/png',\n  extent: null,\n  extraData: null,\n  coordinates: null,\n  scale: 1,\n  onSaveStart: (map) => Promise.resolve(map),\n  onSaveEnd: () => {},\n};\n\n/**\n * The CanvasSaveButton component creates a button to save\n * an [ol/map](https://openlayers.org/en/latest/apidoc/module-ol_Map-Map.html)\n * canvas as an image.\n */\nclass CanvasSaveButton extends PureComponent {\n  constructor(props) {\n    super(props);\n    const { format } = this.props;\n    this.fileExt = format === 'image/jpeg' ? 'jpg' : 'png';\n    this.padding = 5;\n  }\n\n  onClick(evt) {\n    const { map, onSaveStart, onSaveEnd, autoDownload } = this.props;\n    if (window.navigator.msSaveBlob) {\n      // ie only\n      evt.preventDefault();\n      evt.stopPropagation();\n    }\n    onSaveStart(map).then((mapToExport) => {\n      return this.createCanvasImage(mapToExport || map)\n        .then((canvas) => {\n          if (autoDownload) {\n            this.downloadCanvasImage(canvas).then((blob) => {\n              onSaveEnd(mapToExport, canvas, blob);\n            });\n          } else {\n            onSaveEnd(mapToExport, canvas);\n          }\n        })\n        .catch((err) => {\n          if (err) {\n            // eslint-disable-next-line no-console\n            console.error(err);\n          }\n          onSaveEnd(mapToExport, err);\n        });\n    });\n  }\n\n  getDownloadImageName() {\n    return (\n      `${window.document.title.replace(/ /g, '_').toLowerCase()}` +\n      `.${this.fileExt}`\n    );\n  }\n\n  // Ensure the font size fita with the image width.\n  decreaseFontSize(destContext, maxWidth, copyright, scale) {\n    const minFontSize = 8;\n    let sizeMatch;\n    let fontSize;\n    do {\n      sizeMatch = destContext.font.match(/[0-9]+(?:\\.[0-9]+)?(px)/i);\n      fontSize = parseInt(sizeMatch[0].replace(sizeMatch[1], ''), 10);\n\n      // eslint-disable-next-line no-param-reassign\n      destContext.font = destContext.font.replace(fontSize, fontSize - 1);\n\n      if (fontSize - 1 === minFontSize) {\n        this.multilineCopyright = true;\n      }\n    } while (\n      fontSize - 1 > minFontSize &&\n      destContext.measureText(copyright).width * scale > maxWidth\n    );\n    return destContext.font;\n  }\n\n  // If minimal fontsize is reached, divide copyright in two lines.\n  splitCopyrightLine(destContext, destCanvas, maxWidth, copyright, scale) {\n    let newCopyright = copyright;\n    const wordNumber = copyright.split(' ').length;\n\n    for (let i = 0; i < wordNumber; i += 1) {\n      newCopyright = newCopyright.substring(0, newCopyright.lastIndexOf(' '));\n      // Stop removing word when fits within one line.\n      if (destContext.measureText(newCopyright).width * scale < maxWidth) {\n        break;\n      }\n    }\n\n    // Draw fist line (line break isn't supported for fillText).\n    destContext.fillText(\n      newCopyright,\n      this.padding,\n      destCanvas.height / scale - 3 * this.padding,\n    );\n\n    // Draw second line.\n    destContext.fillText(\n      copyright.replace(newCopyright, ''),\n      this.padding,\n      destCanvas.height / scale - this.padding,\n    );\n  }\n\n  drawCopyright(destContext, destCanvas, maxWidth) {\n    const { extraData, scale } = this.props;\n    const { text, font, fillStyle } = extraData.copyright;\n    const copyright = typeof text === 'function' ? text() : text;\n    this.multilineCopyright = false;\n\n    destContext.save();\n    destContext.scale(scale, scale);\n    // eslint-disable-next-line no-param-reassign\n    destContext.font = font || '12px Arial';\n    // eslint-disable-next-line no-param-reassign\n    destContext.fillStyle = fillStyle || 'black';\n\n    this.decreaseFontSize(destContext, maxWidth, copyright, scale);\n\n    if (this.multilineCopyright) {\n      this.splitCopyrightLine(\n        destContext,\n        destCanvas,\n        maxWidth,\n        copyright,\n        scale,\n      );\n    } else {\n      destContext.fillText(\n        copyright,\n        this.padding,\n        destCanvas.height / scale - this.padding,\n      );\n    }\n    destContext.restore();\n  }\n\n  drawElement(data, destCanvas, previousItemSize = [0, 0]) {\n    const destContext = destCanvas.getContext('2d');\n    const { scale } = this.props;\n    const { src, width, height, rotation } = data;\n\n    return new Promise((resolve) => {\n      const img = new Image();\n      img.crossOrigin = 'Anonymous';\n      img.src = src;\n      img.onload = () => {\n        destContext.save();\n        const elementWidth = (width || 80) * scale;\n        const elementHeight = (height || 80) * scale;\n        destContext.translate(\n          destCanvas.width - 2 * this.padding - elementWidth / 2,\n          destCanvas.height -\n            2 * this.padding -\n            elementHeight / 2 -\n            previousItemSize[1],\n        );\n\n        if (rotation) {\n          const angle = typeof rotation === 'function' ? rotation() : rotation;\n          destContext.rotate(angle * (Math.PI / 180));\n        }\n\n        destContext.drawImage(\n          img,\n          -elementWidth / 2,\n          -elementHeight / 2,\n          elementWidth,\n          elementHeight,\n        );\n        destContext.restore();\n\n        // Return the pixels width of the arrow and the margin right,\n        // that must not be occupied by the copyright.\n        resolve([\n          elementWidth + 2 * this.padding,\n          elementHeight + 2 * this.padding,\n        ]);\n      };\n\n      img.onerror = () => {\n        resolve();\n      };\n    });\n  }\n\n  calculatePixelsToExport(mapToExport) {\n    const { extent, coordinates } = this.props;\n    let firstCoordinate;\n    let oppositeCoordinate;\n\n    if (extent) {\n      firstCoordinate = getTopLeft(extent);\n      oppositeCoordinate = getBottomRight(extent);\n    } else if (coordinates) {\n      // In case of coordinates coming from DragBox interaction:\n      //   firstCoordinate is the first coordinate drawn by the user.\n      //   oppositeCoordinate is the coordinate of the point dragged by the user.\n      [firstCoordinate, , oppositeCoordinate] = coordinates;\n    }\n\n    if (firstCoordinate && oppositeCoordinate) {\n      const firstPixel = mapToExport.getPixelFromCoordinate(firstCoordinate);\n      const oppositePixel = mapToExport.getPixelFromCoordinate(\n        oppositeCoordinate,\n      );\n      const pixelTopLeft = [\n        firstPixel[0] <= oppositePixel[0] ? firstPixel[0] : oppositePixel[0],\n        firstPixel[1] <= oppositePixel[1] ? firstPixel[1] : oppositePixel[1],\n      ];\n      const pixelBottomRight = [\n        firstPixel[0] > oppositePixel[0] ? firstPixel[0] : oppositePixel[0],\n        firstPixel[1] > oppositePixel[1] ? firstPixel[1] : oppositePixel[1],\n      ];\n\n      return {\n        x: pixelTopLeft[0],\n        y: pixelTopLeft[1],\n        w: pixelBottomRight[0] - pixelTopLeft[0],\n        h: pixelBottomRight[1] - pixelTopLeft[1],\n      };\n    }\n    return null;\n  }\n\n  createCanvasImage(mapToExport) {\n    const { extraData } = this.props;\n\n    return new Promise((resolve) => {\n      mapToExport.once('rendercomplete', () => {\n        // Find all layer canvases and add it to dest canvas.\n        const canvases = mapToExport\n          .getTargetElement()\n          .getElementsByTagName('canvas');\n\n        // Create the canvas to export with the good size.\n        let destCanvas;\n        let destContext;\n\n        canvases.forEach((canvas) => {\n          if (!canvas.width || !canvas.height) {\n            return;\n          }\n          const clip = this.calculatePixelsToExport(mapToExport) || {\n            x: 0,\n            y: 0,\n            w: canvas.width,\n            h: canvas.height,\n          };\n\n          if (!destCanvas) {\n            destCanvas = document.createElement('canvas');\n            destCanvas.width = clip.w;\n            destCanvas.height = clip.h;\n            destContext = destCanvas.getContext('2d');\n          }\n\n          // Draw canvas to the canvas to export.\n          destContext.drawImage(\n            canvas,\n            clip.x,\n            clip.y,\n            clip.w,\n            clip.h,\n            0,\n            0,\n            destCanvas.width,\n            destCanvas.height,\n          );\n        });\n\n        // Custom info\n        let logoPromise = Promise.resolve();\n        if (destContext && extraData && extraData.logo) {\n          logoPromise = this.drawElement(extraData.logo, destCanvas);\n        }\n\n        logoPromise.then((customItemSize = [0, 0]) => {\n          // North arrow\n          let arrowPromise = Promise.resolve();\n          if (destContext && extraData && extraData.northArrow) {\n            arrowPromise = this.drawElement(\n              {\n                src: extraData.northArrow.circled\n                  ? NorthArrowCircle\n                  : NorthArrowSimple,\n                ...extraData.northArrow,\n              },\n              destCanvas,\n              customItemSize,\n            );\n          }\n\n          // Copyright\n          arrowPromise.then((arrowWidth) => {\n            const widestElement = Math.max(customItemSize[0], arrowWidth);\n            if (\n              destContext &&\n              extraData &&\n              extraData.copyright &&\n              extraData.copyright.text\n            ) {\n              const maxWidth = widestElement\n                ? destContext.canvas.width - widestElement\n                : destContext.canvas.width;\n              this.drawCopyright(destContext, destCanvas, maxWidth);\n            }\n            resolve(destCanvas);\n          });\n        });\n      });\n      mapToExport.renderSync();\n    });\n  }\n\n  downloadCanvasImage(canvas) {\n    // Use blob for large images\n    const promise = new Promise((resolve) => {\n      const { format } = this.props;\n      if (/msie (9|10)/gi.test(window.navigator.userAgent.toLowerCase())) {\n        // ie 9 and 10\n        const url = canvas.toDataURL(format);\n        const w = window.open('about:blank', '');\n        w.document.write(`<img src=\"${url}\" alt=\"from canvas\"/>`);\n        resolve(url);\n      }\n      if (window.navigator.msSaveBlob) {\n        // ie 11 and higher\n        let image;\n        try {\n          image = canvas.msToBlob();\n        } catch (e) {\n          // eslint-disable-next-line no-console\n          console.log(e);\n        }\n        const blob = new Blob([image], {\n          type: format,\n        });\n        resolve(blob);\n        window.navigator.msSaveBlob(blob, this.getDownloadImageName());\n      } else {\n        canvas.toBlob((blob) => {\n          const link = document.createElement('a');\n          link.download = this.getDownloadImageName();\n          link.href = URL.createObjectURL(blob);\n          // append child to document for firefox to be able to download.\n          document.body.appendChild(link);\n          link.click();\n          resolve(blob);\n        }, format);\n      }\n    });\n    return promise;\n  }\n\n  render() {\n    const { children, ...other } = this.props;\n\n    delete other.onSaveStart;\n    delete other.onSaveEnd;\n    delete other.extraData;\n    delete other.extent;\n    delete other.format;\n    delete other.map;\n    delete other.coordinates;\n    delete other.autoDownload;\n    delete other.scale;\n\n    return (\n      <div\n        role=\"button\"\n        className=\"rs-canvas-save-button\"\n        tabIndex={0}\n        // eslint-disable-next-line react/jsx-props-no-spreading\n        {...other}\n        onClick={(e) => this.onClick(e)}\n        onKeyPress={(e) => e.which === 13 && this.onClick(e)}\n      >\n        {children}\n      </div>\n    );\n  }\n}\n\nCanvasSaveButton.propTypes = propTypes;\nCanvasSaveButton.defaultProps = defaultProps;\n\nexport default CanvasSaveButton;\n"],"names":["const","super","this","let"],"mappings":"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"}