{"version":3,"file":"BaseLayerToggler.js","sources":["../../../src/components/BaseLayerToggler/BaseLayerToggler.js"],"sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { FaArrowCircleLeft, FaArrowCircleRight } from 'react-icons/fa';\nimport OLMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\nimport TileLayer from 'ol/layer/Tile';\nimport { containsExtent } from 'ol/extent';\nimport LayerService from '../../LayerService';\nimport BasicMap from '../BasicMap';\n\nconst propTypes = {\n  /**\n   * An [ol/map](https://openlayers.org/en/latest/apidoc/module-ol_Map-Map.html)\n   */\n  map: PropTypes.instanceOf(OLMap).isRequired,\n\n  /**\n   * LayerService.\n   */\n  layerService: PropTypes.instanceOf(LayerService),\n\n  /**\n   * CSS class to apply on the container.\n   */\n  className: PropTypes.string,\n\n  /**\n   * Children of the previous baselayer button.\n   */\n  prevButtonContent: PropTypes.node,\n\n  /**\n   * Children of the next baselayer button.\n   */\n  nextButtonContent: PropTypes.node,\n\n  /**\n   * Path to the directory which includes the fallback images\n   */\n  fallbackImgDir: PropTypes.string,\n\n  /**\n   * Outside of this valid extent the fallback image is loaded\n   */\n  validExtent: PropTypes.arrayOf(PropTypes.number),\n\n  /**\n   * Button titles.\n   */\n  titles: PropTypes.shape({\n    button: PropTypes.string,\n    prevButton: PropTypes.stirng,\n    nextButton: PropTypes.string,\n  }),\n};\n\nconst defaultProps = {\n  layerService: undefined,\n  className: 'rs-base-layer-toggler',\n  prevButtonContent: <FaArrowCircleLeft focusable={false} />,\n  nextButtonContent: <FaArrowCircleRight focusable={false} />,\n  fallbackImgDir: '../../images/baselayer/',\n  validExtent: [-Infinity, -Infinity, Infinity, Infinity],\n  titles: {\n    button: 'Toggle base layer',\n    nextButton: 'Next base layer',\n    prevButton: 'Previous base layer',\n  },\n};\n\n/**\n * The BaseLayerToggler component renders a button interface for switching the visible\n * [mobility-toolbox-js layer](https://mobility-toolbox-js.geops.io/api/identifiers%20html#ol-layers)\n * when defined as base layer.\n */\nclass BaseLayerToggler extends Component {\n  static isDifferentLayers(prevLayers, layers) {\n    if (prevLayers && layers) {\n      return (\n        JSON.stringify(prevLayers.map((l) => l.key)) !==\n        JSON.stringify(layers.map((l) => l.key))\n      );\n    }\n    return false;\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      layers: null,\n      layerVisible: null,\n      idx: 0,\n      fallbackImg: null,\n      fallbackImgOpacity: 0,\n    };\n    this.map = null;\n    this.ref = React.createRef();\n\n    this.updateState = this.updateState.bind(this);\n    this.resetState = this.resetState.bind(this);\n  }\n\n  componentDidMount() {\n    const { layerService, map } = this.props;\n\n    if (layerService) {\n      this.updateLayerService();\n    }\n\n    if (map) {\n      this.updateMap();\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const { layerService, map } = this.props;\n    const { layerVisible, idx, layers } = this.state;\n\n    if (layerService !== prevProps.layerService) {\n      this.updateLayerService();\n    }\n\n    if (map !== prevProps.map) {\n      this.updateMap();\n    }\n\n    if (layerVisible && !prevState.layerVisible) {\n      this.next();\n    } else if (\n      layerVisible !== prevState.layerVisible &&\n      layers.includes(prevState.layerVisible)\n    ) {\n      // In case the visibility of the background Layer is change from another component.\n      this.toggle(prevState.layerVisible);\n    }\n\n    if (\n      this.map &&\n      (idx !== prevState.idx ||\n        BaseLayerToggler.isDifferentLayers(prevState.layers, layers))\n    ) {\n      this.map.getLayers().clear();\n\n      if (!layers.length) {\n        return;\n      }\n      let children = [];\n      let childLayers = [];\n      if (idx !== null && idx < layers.length) {\n        children = layers[idx].children;\n        childLayers = children.length ? children : [layers[idx]];\n      }\n\n      childLayers.forEach((layer) => {\n        if (layer.clone) {\n          let ml;\n          // MapboxStyleLayer\n          if (layer.mapboxLayer) {\n            ml = layer.mapboxLayer.clone();\n            ml.init(this.map); // Including addLayer\n            ml.setVisible(true);\n          }\n          const cloned = layer.clone(ml);\n          cloned.init(this.map); // Including addLayer\n          cloned.setVisible(true);\n        } else if (layer.olLayer && layer.olLayer instanceof TileLayer) {\n          this.map.addLayer(\n            new TileLayer({\n              source: layer.olLayer.getSource(),\n            }),\n          );\n        }\n        this.checkExtent();\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    const { layerService } = this.props;\n    unByKey([this.postRenderKey, this.moveEndKey]);\n    layerService.un('change:visible', this.updateState);\n    layerService.un('change:layers', this.resetState);\n  }\n\n  setNextVisible(nextLayer) {\n    const { layers } = this.state;\n    // Unset visibility to all layers before showing the next layer.\n    layers.forEach((l) => l.visible && l.setVisible(false, true, true, true));\n    nextLayer.setVisible(true);\n  }\n\n  updateLayerService() {\n    const { layerService } = this.props;\n\n    if (!layerService) {\n      return;\n    }\n    layerService.un('change:visible', this.updateState);\n    layerService.un('change:layers', this.resetState);\n    this.updateState();\n    layerService.on('change:visible', this.updateState);\n    layerService.on('change:layers', this.resetState);\n  }\n\n  updateState(evtLayer) {\n    if (evtLayer && !evtLayer.isBaseLayer) {\n      return;\n    }\n\n    const { layerService } = this.props;\n    const { idx } = this.state;\n\n    const layers = layerService.getBaseLayers() || [];\n    let newIdx = idx;\n    if (newIdx === -1 && layers.length > 1) {\n      newIdx = 0;\n      layers[idx].setVisible(true);\n    }\n\n    this.setState({\n      layers,\n      idx: newIdx,\n      layerVisible: layers.length > 1 ? layers[newIdx] : null,\n    });\n  }\n\n  resetState() {\n    const { layerService } = this.props;\n    const { layerVisible } = this.state;\n\n    const layers = layerService.getBaseLayers() || [];\n    const idx = layerVisible ? layers.indexOf(layerVisible) : -1;\n    let newIdx;\n\n    if (idx === -1) {\n      newIdx = 1;\n    } else if (idx === layers.length - 1) {\n      newIdx = 0;\n    } else {\n      newIdx = idx + 1;\n    }\n\n    const newLayerVisible = layers[idx === -1 ? 0 : idx];\n    this.setState({\n      layers,\n      idx: layers.length > 1 ? newIdx : null,\n      layerVisible:\n        layers.indexOf(newLayerVisible) >= 0 ? newLayerVisible : undefined,\n    });\n  }\n\n  updateMap() {\n    const { map } = this.props;\n    if (!this.map) {\n      this.map = new OLMap({ controls: [], interactions: [] });\n    }\n    unByKey([this.postRenderKey, this.moveEndKey]);\n    this.postRenderKey = map.on('postrender', (e) => {\n      this.map.getView().setZoom(e.target.getView().getZoom());\n      if (this.ref && this.ref.current) {\n        const elt = this.ref.current;\n        const coord = map.getCoordinateFromPixel([\n          elt.offsetLeft + elt.offsetWidth / 2,\n          elt.offsetTop + elt.offsetHeight / 2,\n        ]);\n\n        // In some case the map is not able to get the coord.\n        // For example if the map has a width or height of 0.\n        if (!coord) {\n          return;\n        }\n\n        this.map.getView().setCenter(coord);\n      }\n    });\n\n    this.moveEndKey = map.on('moveend', () => {\n      this.checkExtent();\n    });\n  }\n\n  toggle(layer) {\n    const { layers } = this.state;\n\n    let index = 0;\n    while (layer !== layers[index]) {\n      index += 1;\n    }\n\n    this.setState({\n      idx: index,\n    });\n  }\n\n  previous() {\n    const { layers, layerVisible, idx } = this.state;\n    let previousIdx = idx - 1;\n\n    while (!layers[previousIdx] || layerVisible === layers[previousIdx]) {\n      previousIdx -= 1;\n      if (previousIdx < 0) {\n        previousIdx = layers.length - 1;\n      }\n    }\n\n    this.setState({\n      idx: previousIdx,\n    });\n  }\n\n  next() {\n    const { layers, layerVisible, idx } = this.state;\n    let nextIdx = idx + 1;\n\n    while (!layers[nextIdx] || layerVisible === layers[nextIdx]) {\n      nextIdx += 1;\n      if (nextIdx >= layers.length) {\n        nextIdx = 0;\n      }\n    }\n\n    this.setState({\n      idx: nextIdx,\n    });\n  }\n\n  /**\n   * Check if the next layer is inside the global extent.\n   * If not, try setting a global image.\n   */\n  checkExtent() {\n    const { validExtent, map, fallbackImgDir } = this.props;\n    const { idx, layers, fallbackImg } = this.state;\n    const nextLayer = layers[idx];\n    let opacity = 0;\n    let img = fallbackImg;\n\n    if (validExtent && this.ref && this.ref.current && nextLayer) {\n      const elt = this.ref.current;\n      const blCoord = map.getCoordinateFromPixel([\n        elt.offsetLeft,\n        elt.offsetTop + elt.offsetHeight,\n      ]);\n      const trCoord = map.getCoordinateFromPixel([\n        elt.offsetLeft + elt.offsetWidth,\n        elt.offsetTop,\n      ]);\n\n      if (!blCoord || !trCoord) {\n        return;\n      }\n\n      if (!containsExtent(validExtent, [...blCoord, ...trCoord])) {\n        opacity = 1;\n        img = `${fallbackImgDir}${nextLayer.key}.png`;\n      }\n    }\n\n    this.setState({\n      fallbackImg: img,\n      fallbackImgOpacity: opacity,\n    });\n  }\n\n  render() {\n    const {\n      className,\n      titles,\n      prevButtonContent,\n      nextButtonContent,\n    } = this.props;\n    const { layers, idx, fallbackImg, fallbackImgOpacity } = this.state;\n\n    let footer = null;\n\n    if (!layers || layers.length < 2) {\n      return null;\n    }\n\n    if (layers.length > 2) {\n      footer = (\n        <div className=\"rs-base-layer-footer\">\n          <div\n            className=\"rs-base-layer-previous\"\n            role=\"button\"\n            onClick={() => this.previous()}\n            onKeyPress={(e) => e.which === 13 && this.previous()}\n            tabIndex=\"0\"\n            aria-label={titles.prevButton}\n            title={titles.prevButton}\n          >\n            {prevButtonContent}\n          </div>\n          <div\n            className=\"rs-base-layer-next\"\n            role=\"button\"\n            onClick={() => this.next()}\n            onKeyPress={(e) => e.which === 13 && this.next()}\n            tabIndex=\"0\"\n            aria-label={titles.nextButton}\n            title={titles.nextButton}\n          >\n            {nextButtonContent}\n          </div>\n        </div>\n      );\n    }\n\n    const nextLayer = layers[idx];\n\n    return (\n      <div className={className} ref={this.ref}>\n        <div\n          className=\"rs-base-layer-toggle-button\"\n          role=\"button\"\n          title={titles.button}\n          aria-label={titles.button}\n          onClick={() => this.setNextVisible(nextLayer)}\n          onKeyPress={(e) => e.which === 13 && this.setNextVisible(nextLayer)}\n          tabIndex=\"0\"\n        >\n          <img\n            src={fallbackImg}\n            alt={fallbackImg}\n            style={{ opacity: fallbackImgOpacity }}\n            className=\"rs-base-layer-image\"\n          />\n          <BasicMap\n            map={this.map}\n            className=\"rs-base-layer-map\"\n            tabIndex={-1}\n          />\n        </div>\n        {footer}\n      </div>\n    );\n  }\n}\n\nBaseLayerToggler.propTypes = propTypes;\nBaseLayerToggler.defaultProps = defaultProps;\n\nexport default BaseLayerToggler;\n"],"names":["const","super","let","this"],"mappings":"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"}