{"version":3,"file":"Search.js","sources":["../../../src/components/Search/Search.js"],"sourcesContent":["import PropTypes from 'prop-types';\nimport React, { useMemo, useState } from 'react';\nimport Autosuggest from 'react-autosuggest';\nimport { FaSearch, FaTimes } from 'react-icons/fa';\n\nimport SearchService from './SearchService';\nimport StopFinder from './engines/StopFinder';\n\nconst propTypes = {\n  /**\n   * Flat object to provide custom search engines: key is the section and value an instance of the Engine class.\n   */\n  engines: PropTypes.object,\n\n  /**\n   * A function which will receive the searchService instance and needs to return a render function for the section title, see [react-autosuggest documentation](https://github.com/moroshko/react-autosuggest#render-section-title-prop) for details.\n   */\n  getRenderSectionTitle: PropTypes.func,\n\n  /**\n   * Initial value for the search input field.\n   */\n  initialValue: PropTypes.string,\n\n  /**\n   * Props for the search input field, see [react-autosuggest documentation](https://github.com/moroshko/react-autosuggest#input-props-prop) for details.\n   */\n  inputProps: PropTypes.object,\n\n  /**\n   * Callback function which will be called with the hovered suggestion.\n   */\n  onHighlight: PropTypes.func,\n\n  /**\n   * Function to define whether the suggestions are displayed or not.\n   * See 'shouldRenderSuggestions' in [react-autosuggest documentation](https://github.com/moroshko/react-autosuggest#input-props-prop) for details.\n   */\n  shouldRenderSuggestions: PropTypes.func,\n\n  /**\n   * Callback function which will be called with the selected suggestion.\n   */\n  onSelect: PropTypes.func,\n\n  /**\n   * CSS class of the component.\n   */\n  className: PropTypes.string,\n\n  /**\n   * Key to access the engine api.\n   */\n  apiKey: PropTypes.string,\n};\n\nconst defaultProps = {\n  apiKey: null,\n  engines: null,\n  getRenderSectionTitle: () => () => null,\n  initialValue: '',\n  onHighlight: () => null,\n  shouldRenderSuggestions: (newValue) => newValue.trim().length > 2,\n  onSelect: () => null,\n  className: 'rt-search',\n  inputProps: {},\n};\n\n/**\n * The Search component renders a text input field which searches for stops\n * using the input string and centers the map on the selected stop.\n */\nfunction Search({\n  apiKey,\n  engines,\n  getRenderSectionTitle,\n  initialValue,\n  inputProps,\n  onHighlight,\n  shouldRenderSuggestions,\n  onSelect,\n  className,\n}) {\n  const currentEngines = useMemo(() => {\n    if (!engines) {\n      return {\n        stops: new StopFinder(null, { apiKey }),\n      };\n    }\n    if (apiKey) {\n      Object.values(engines).forEach((engine) => {\n        if (engine.setApiKey) {\n          engine.setApiKey(apiKey);\n        }\n      });\n    }\n    return engines;\n  }, [apiKey, engines]);\n\n  const [suggestions, setSuggestions] = useState([]);\n  const [value, setValue] = useState(initialValue);\n\n  const searchService = useMemo(\n    () =>\n      new SearchService({ apiKey, engines: currentEngines, setSuggestions }),\n    [apiKey, engines, setSuggestions],\n  );\n\n  const theme = useMemo(() => {\n    return {\n      container: `${className}__container`,\n      containerOpen: `${className}__container--open`,\n      input: `${className}__input`,\n      inputOpen: `${className}__input--open`,\n      inputFocused: `${className}__input--focused`,\n      suggestionsContainer: `${className}__suggestions-container`,\n      suggestionsContainerOpen: `${className}__suggestions-container--open`,\n      suggestionsList: `${className}__suggestions-list`,\n      suggestion: `${className}__suggestion`,\n      suggestionFirst: `${className}__suggestion--first`,\n      suggestionHighlighted: `${className}__suggestion--highlighted`,\n      sectionContainer: `${className}__section-container`,\n      sectionContainerFirst: `${className}__section-container--first`,\n      sectionTitle: `${className}__section-title`,\n    };\n  }, [className]);\n\n  return (\n    Object.keys(currentEngines).length > 0 && (\n      <div className=\"rt-search\">\n        <Autosuggest\n          theme={theme}\n          inputProps={{\n            autoFocus: true,\n            tabIndex: 0,\n            onChange: (e, { newValue }) => setValue(newValue),\n            onKeyUp: ({ key }) => {\n              if (key === 'Enter') {\n                const filtered = suggestions.filter((s) => s.items.length > 0);\n                if (filtered.length > 0) {\n                  const { items, section } = filtered[0];\n                  const targetSuggestion = { ...items[0], section };\n                  setValue(searchService.value(targetSuggestion));\n                  onSelect(targetSuggestion);\n                }\n              } else if (\n                (key === 'ArrowDown' || key === 'ArrowUp') &&\n                typeof searchService.highlightSection === 'function'\n              ) {\n                searchService.highlightSection(); // for improved accessibility\n              }\n            },\n            value,\n            ...inputProps,\n          }}\n          multiSection\n          getSectionSuggestions={({ items, section }) =>\n            items ? items.map((i) => ({ ...i, section })) : []\n          }\n          getSuggestionValue={(suggestion) => searchService.value(suggestion)}\n          onSuggestionsFetchRequested={({ value: newValue }) =>\n            searchService.search(newValue)\n          }\n          onSuggestionsClearRequested={() => setSuggestions([])}\n          onSuggestionHighlighted={({ suggestion }) => onHighlight(suggestion)}\n          onSuggestionSelected={(e, { suggestion }) => onSelect(suggestion)}\n          renderSuggestion={(suggestion) => searchService.render(suggestion)}\n          renderSectionTitle={getRenderSectionTitle(searchService)}\n          shouldRenderSuggestions={(newValue) =>\n            shouldRenderSuggestions(newValue)\n          }\n          suggestions={suggestions}\n        />\n        {value && (\n          <button\n            type=\"button\"\n            tabIndex={0}\n            className=\"rt-search-button rt-search-button-clear\"\n            onClick={() => setValue('')}\n          >\n            <FaTimes />\n          </button>\n        )}\n        <button\n          type=\"button\"\n          tabIndex={0}\n          className=\"rt-search-button rt-search-button-submit\"\n        >\n          <FaSearch focusable={false} />\n        </button>\n      </div>\n    )\n  );\n}\n\nSearch.propTypes = propTypes;\nSearch.defaultProps = defaultProps;\n\nexport default Search;\n"],"names":["const"],"mappings":"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"}