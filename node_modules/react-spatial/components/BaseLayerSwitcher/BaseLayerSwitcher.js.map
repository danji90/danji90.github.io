{"version":3,"file":"BaseLayerSwitcher.js","sources":["../../../src/components/BaseLayerSwitcher/BaseLayerSwitcher.js"],"sourcesContent":["/* eslint-disable jsx-a11y/interactive-supports-focus */\nimport React, { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { FaChevronLeft } from 'react-icons/fa';\nimport { Layer } from 'mobility-toolbox-js/ol';\n\nimport './BaseLayerSwitcher.scss';\n\nconst propTypes = {\n  /**\n   * An array of [mobility-toolbox-js layers](https://mobility-toolbox-js.geops.io/api/identifiers%20html#ol-layers).\n   */\n  layers: PropTypes.arrayOf(PropTypes.instanceOf(Layer)).isRequired,\n\n  /**\n   * Object containing relative paths to the base layer images. Object\n   * keys need to correspond to layer keys\n   */\n  layerImages: PropTypes.objectOf(PropTypes.string),\n\n  /**\n   * CSS class to apply on the container.\n   */\n  className: PropTypes.string,\n\n  /**\n   * Alternative text rendered if layer images can't be loaded\n   */\n  altText: PropTypes.string,\n\n  /**\n   * Button titles.\n   */\n  titles: PropTypes.shape({\n    button: PropTypes.string,\n    openSwitcher: PropTypes.string,\n    closeSwitcher: PropTypes.string,\n  }),\n\n  /**\n   * Image (node) rendered in the switcher close button.\n   */\n  closeButtonImage: PropTypes.node,\n\n  /**\n   * Translation function.\n   * @param {function} Translation function returning the translated string.\n   */\n  t: PropTypes.func,\n};\n\nconst defaultProps = {\n  className: 'rs-base-layer-switcher',\n  altText: 'Source not found',\n  titles: {\n    button: 'Base layers',\n    openSwitcher: 'Open Baselayer-Switcher',\n    closeSwitcher: 'Close Baselayer-Switcher',\n  },\n  closeButtonImage: <FaChevronLeft />,\n  layerImages: undefined,\n  t: (s) => s,\n};\n\nconst getVisibleLayer = (layers) => {\n  return layers.find((layer) => layer.visible);\n};\n\nconst getNextImage = (currentLayer, layers, layerImages) => {\n  const currentIndex = layers.indexOf(\n    layers.find((layer) => layer === currentLayer),\n  );\n  const nextIndex = currentIndex + 1 === layers.length ? 0 : currentIndex + 1;\n  return layerImages[nextIndex];\n};\n\nconst getImageStyle = (url) => {\n  return url\n    ? {\n        backgroundImage: `url(${url})`,\n        backgroundSize: 'cover',\n        backgroundRepeat: 'no-repeat',\n        backgroundPosition: 'center',\n      }\n    : null;\n};\n\n/**\n * The BaseLayerSwitcher component renders a button interface for switching the visible\n * [mobility-toolbox-js layer](https://mobility-toolbox-js.geops.io/api/identifiers%20html#ol-layers)\n * when defined as base layer.\n */\n\nfunction BaseLayerSwitcher({\n  layers,\n  layerImages,\n  className,\n  altText,\n  titles,\n  closeButtonImage,\n  t,\n}) {\n  const baseLayers = layers.filter((layer) => layer.isBaseLayer);\n  const [switcherOpen, setSwitcherOpen] = useState(false);\n  const [isClosed, setIsClosed] = useState(true);\n  const [currentLayer, setCurrentLayer] = useState(\n    getVisibleLayer(baseLayers) || baseLayers[0],\n  );\n\n  /* Images are loaded from props if provided, fallback from layer */\n  const images = layerImages\n    ? Object.keys(layerImages).map((layerImage) => layerImages[layerImage])\n    : baseLayers.map((layer) => layer.get('previewImage'));\n\n  const openClass = switcherOpen ? ' rs-open' : '';\n  const hiddenStyle = switcherOpen && !isClosed ? 'visible' : 'hidden';\n\n  const handleSwitcherClick = () => {\n    if (baseLayers.length === 2) {\n      /* On only two layer options the opener becomes a layer toggle button */\n      const nextLayer = baseLayers.find((layer) => !layer.visible);\n      currentLayer.setVisible(false);\n      setCurrentLayer(nextLayer);\n      nextLayer.setVisible(true);\n      return;\n    }\n    // eslint-disable-next-line consistent-return\n    return setSwitcherOpen(true) && setIsClosed(false);\n  };\n\n  const onLayerSelect = (layer) => {\n    if (!switcherOpen) {\n      setSwitcherOpen(true);\n      return;\n    }\n    setCurrentLayer(layer);\n    layer.setVisible(true);\n    baseLayers.filter((l) => l !== layer).forEach((l) => l.setVisible(false));\n    setSwitcherOpen(false);\n  };\n\n  /* Get next image for closed button */\n  const nextImage = getNextImage(currentLayer, baseLayers, images);\n\n  useEffect(() => {\n    /* Ensure correct layer is active on app load */\n    if (currentLayer !== getVisibleLayer(baseLayers)) {\n      setCurrentLayer(getVisibleLayer(baseLayers) || baseLayers[0]);\n    }\n  }, [currentLayer, baseLayers]);\n\n  useEffect(() => {\n    /* Used for correct layer image render with animation */\n    let timeout;\n    if (!switcherOpen) {\n      timeout = setTimeout(() => {\n        setIsClosed(true);\n      }, 200);\n    } else {\n      timeout = setTimeout(() => {\n        setIsClosed(false);\n      }, 800);\n    }\n    return () => clearTimeout(timeout);\n  }, [switcherOpen]);\n\n  if (!baseLayers || baseLayers.length < 2 || !currentLayer) {\n    return null;\n  }\n\n  const toggleBtn = (\n    <div className=\"rs-base-layer-switcher-btn-wrapper\">\n      <div\n        className=\"rs-base-layer-switcher-close-btn\"\n        role=\"button\"\n        onClick={() => setSwitcherOpen(false)}\n        onKeyPress={(e) => e.which === 13 && setSwitcherOpen(false)}\n        tabIndex={switcherOpen ? '0' : '-1'}\n        aria-label={titles.closeSwitcher}\n        title={titles.closeSwitcher}\n      >\n        {closeButtonImage}\n      </div>\n    </div>\n  );\n\n  return (\n    <div className={`${className}${openClass}`}>\n      {\n        <div\n          className={`rs-base-layer-switcher-button rs-opener${openClass}`}\n          role=\"button\"\n          title={titles.openSwitcher}\n          aria-label={titles.openSwitcher}\n          onClick={handleSwitcherClick}\n          onKeyPress={(e) => {\n            if (e.which === 13) {\n              handleSwitcherClick();\n            }\n          }}\n          style={getImageStyle(nextImage)}\n          tabIndex=\"0\"\n        >\n          <div className=\"rs-base-layer-switcher-title\">\n            {baseLayers.length !== 2\n              ? titles.button\n              : baseLayers.find((layer) => !layer.visible) &&\n                t(baseLayers.find((layer) => !layer.visible).name)}\n          </div>\n          {nextImage ? null : <span className=\"rs-alt-text\">{t(altText)}</span>}\n        </div>\n      }\n      {baseLayers.map((layer, idx) => {\n        const layerName = layer.name;\n        const activeClass = layerName === currentLayer.name ? ' rs-active' : '';\n        const imageStyle = getImageStyle(\n          layerImages ? layerImages[`${layer.key}`] : layer.get('previewImage'),\n        );\n        return (\n          <div\n            key={layer.key}\n            className=\"rs-base-layer-switcher-btn-wrapper\"\n            style={{\n              overflow: hiddenStyle,\n              zIndex: baseLayers.length - idx,\n            }}\n          >\n            <div\n              className={`rs-base-layer-switcher-button${openClass}`}\n              role=\"button\"\n              title={t(layerName)}\n              aria-label={t(layerName)}\n              onClick={() => onLayerSelect(layer)}\n              onKeyPress={(e) => {\n                if (e.which === 13) {\n                  onLayerSelect(layer);\n                }\n              }}\n              style={imageStyle}\n              tabIndex={switcherOpen ? '0' : '-1'}\n            >\n              <div className={`rs-base-layer-switcher-title${activeClass}`}>\n                {t(layerName)}\n              </div>\n              {imageStyle ? null : (\n                <span className=\"rs-alt-text\">{t(altText)}</span>\n              )}\n            </div>\n          </div>\n        );\n      })}\n      {toggleBtn}\n    </div>\n  );\n}\n\nBaseLayerSwitcher.propTypes = propTypes;\nBaseLayerSwitcher.defaultProps = defaultProps;\n\nexport default BaseLayerSwitcher;\n"],"names":["const","let"],"mappings":"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"}