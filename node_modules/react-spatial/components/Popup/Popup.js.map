{"version":3,"file":"Popup.js","sources":["../../../src/components/Popup/Popup.js"],"sourcesContent":["import React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\n\nimport { MdClose } from 'react-icons/md';\nimport OLMap from 'ol/Map';\nimport Feature from 'ol/Feature';\nimport { getCenter } from 'ol/extent';\nimport { unByKey } from 'ol/Observable';\n\nconst propTypes = {\n  /**\n   * React Children.\n   */\n  children: PropTypes.node.isRequired,\n\n  /**\n   * An [ol/map](https://openlayers.org/en/latest/apidoc/module-ol_Map-Map.html).\n   */\n  map: PropTypes.instanceOf(OLMap).isRequired,\n\n  /**\n   * An [ol/Feature](https://openlayers.org/en/latest/apidoc/module-ol_Feature-Feature.html).\n   */\n  feature: PropTypes.instanceOf(Feature),\n\n  /**\n   * Popup title.\n   */\n  header: PropTypes.oneOfType([PropTypes.string, PropTypes.element]),\n\n  /**\n   * If true, the popup is panned in the map's viewport.\n   */\n  panIntoView: PropTypes.bool,\n\n  /**\n   * Custom BoundingClientRect to fit popup into.\n   * Use if panIntoView is true. Default is the map's BoundingClientRect.\n   */\n  panRect: PropTypes.objectOf(PropTypes.number),\n\n  /**\n   * Coordinate position of the popup.\n   */\n  popupCoordinate: PropTypes.arrayOf(PropTypes.number),\n\n  /**\n   * Class name of the popup.\n   */\n  className: PropTypes.string,\n\n  /**\n   * Title HTML attributes.\n   */\n  titles: PropTypes.shape({\n    closeButton: PropTypes.string,\n  }),\n\n  /**\n   * Function triggered on close button click.\n   */\n  onCloseClick: PropTypes.func,\n\n  /**\n   * HTML tabIndex attribute.\n   */\n  tabIndex: PropTypes.string,\n\n  /**\n   * Render the header\n   */\n  renderHeader: PropTypes.func,\n\n  /**\n   * Render the close button\n   */\n  renderCloseButton: PropTypes.func,\n\n  /**\n   * Render the footer\n   */\n  renderFooter: PropTypes.func,\n};\n\nconst defaultProps = {\n  header: null,\n  feature: null,\n  panIntoView: false,\n  panRect: null,\n  popupCoordinate: null,\n  className: 'rs-popup',\n  tabIndex: '',\n  titles: { closeButton: 'Close' },\n  onCloseClick: () => {},\n  renderHeader: null,\n  renderCloseButton: null,\n  renderFooter: () => null,\n};\n\n/**\n * The Popup component renders a popup over an\n * [ol/Feature](https://openlayers.org/en/latest/apidoc/module-ol_Feature-Feature.html)\n * on click.\n */\nclass Popup extends PureComponent {\n  static renderHeader(props) {\n    const { header, renderCloseButton } = props;\n    return (\n      <div className=\"rs-popup-header\">\n        {header}\n        {(renderCloseButton || Popup.renderCloseButton)(props)}\n      </div>\n    );\n  }\n\n  static renderCloseButton({ onCloseClick, titles }) {\n    return (\n      <div\n        role=\"button\"\n        tabIndex={0}\n        className=\"rs-popup-close-bt\"\n        title={titles.closeButton}\n        aria-label={titles.closeButton}\n        onClick={() => onCloseClick()}\n        onKeyPress={(evt) => evt.which === 13 && onCloseClick()}\n      >\n        <MdClose focusable={false} />\n      </div>\n    );\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      popupElement: null,\n      top: 0,\n      left: 0,\n    };\n    this.postrenderKey = null;\n  }\n\n  componentDidMount() {\n    const { map } = this.props;\n    this.updatePixelPosition();\n\n    this.postrenderKey = map.on('postrender', () => {\n      this.updatePixelPosition();\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const { feature, panIntoView, popupCoordinate } = this.props;\n    const { popupElement } = this.state;\n    if (\n      feature !== prevProps.feature ||\n      popupCoordinate !== prevProps.popupCoordinate\n    ) {\n      this.updatePixelPosition();\n    }\n\n    if (\n      panIntoView &&\n      popupElement &&\n      popupElement !== prevState.popupElement\n    ) {\n      this.panIntoView();\n    }\n  }\n\n  componentWillUnmount() {\n    unByKey(this.postrenderKey);\n  }\n\n  panIntoView() {\n    const { map, panRect } = this.props;\n    const { popupElement } = this.state;\n\n    const mapRect = panRect || map.getTarget().getBoundingClientRect();\n    const popupRect = popupElement.getBoundingClientRect();\n    const [x, y] = map.getView().getCenter();\n    const res = map.getView().getResolution();\n    const newCenter = [x, y];\n\n    if (mapRect.top > popupRect.top) {\n      newCenter[1] = y + (mapRect.top - popupRect.top) * res;\n    }\n\n    if (mapRect.left > popupRect.left) {\n      newCenter[0] = x - (mapRect.left - popupRect.left) * res;\n    }\n\n    if (mapRect.right < popupRect.right) {\n      newCenter[0] = x + (popupRect.right - mapRect.right) * res;\n    }\n\n    if (mapRect.bottom < popupRect.bottom) {\n      newCenter[1] = y - (popupRect.bottom - mapRect.bottom) * res;\n    }\n\n    if (newCenter[0] !== x || newCenter[1] !== y) {\n      map.getView().animate({ center: newCenter, duration: 500 });\n    }\n  }\n\n  updatePixelPosition() {\n    const { map, feature, popupCoordinate } = this.props;\n    let coord = popupCoordinate;\n\n    if (feature && !coord) {\n      coord = getCenter(feature.getGeometry().getExtent());\n    }\n\n    if (coord) {\n      const pos = map.getPixelFromCoordinate(coord);\n\n      if (pos && pos.length === 2) {\n        this.setState({\n          left: pos[0],\n          top: pos[1],\n        });\n      }\n    }\n  }\n\n  render() {\n    const {\n      feature,\n      popupCoordinate,\n      children,\n      header,\n      titles,\n      tabIndex,\n      renderHeader,\n      renderFooter,\n      ...other\n    } = this.props;\n\n    if (!feature && !popupCoordinate) {\n      return null;\n    }\n\n    delete other.panIntoView;\n    delete other.panRect;\n    delete other.map;\n    delete other.header;\n    delete other.onCloseClick;\n    delete other.renderCloseButton;\n\n    const { top, left } = this.state;\n\n    // force re-render if the feature or the coordinate changes.\n    // this is needed to update the popupElement ref\n    const key = feature ? feature.getId() : popupCoordinate.join();\n    return (\n      <div\n        className=\"rs-popup\"\n        style={{\n          left,\n          top,\n        }}\n        // eslint-disable-next-line react/jsx-props-no-spreading\n        {...other}\n      >\n        <div\n          className=\"rs-popup-container\"\n          tabIndex={tabIndex}\n          key={key}\n          ref={(popupElement) => {\n            this.setState({ popupElement });\n          }}\n        >\n          {(renderHeader || Popup.renderHeader)(this.props)}\n          <div className=\"rs-popup-body\">{children}</div>\n          {renderFooter(this.props)}\n        </div>\n      </div>\n    );\n  }\n}\n\nPopup.propTypes = propTypes;\nPopup.defaultProps = defaultProps;\n\nexport default Popup;\n"],"names":["const","super","this","let"],"mappings":"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"}