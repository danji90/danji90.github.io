{"version":3,"file":"FeatureExportButton.js","sources":["../../../src/components/FeatureExportButton/FeatureExportButton.js"],"sourcesContent":["import React, { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport KMLFormat from 'ol/format/KML';\nimport { Layer } from 'mobility-toolbox-js/ol';\nimport KML from '../../utils/KML';\n\nconst propTypes = {\n  /**\n   *  Children content of the Feature export button.\n   */\n  children: PropTypes.node,\n\n  /**\n   * Format to export features (function).\n   * Supported formats: https://openlayers.org/en/latest/apidoc/module-ol_format_Feature-FeatureFormat.html\n   */\n  format: PropTypes.func,\n\n  /**\n   * An existing [mobility-toolbox-js Layer](https://mobility-toolbox-js.geops.io/api/identifiers%20html#ol-layers),\n   * using a valid [ol/source/Vector](https://openlayers.org/en/latest/apidoc/module-ol_source_Vector.html)\n   */\n  layer: PropTypes.instanceOf(Layer).isRequired,\n\n  /**\n   * Map projection.\n   */\n  projection: PropTypes.string,\n};\n\nconst defaultProps = {\n  children: null,\n  format: KMLFormat,\n  projection: 'EPSG:3857',\n};\n\n/**\n * The FeatureExportButton component creates a button that exports feature geometries\n * from a [[mobility-toolbox-js Layer](https://mobility-toolbox-js.geops.io/api/identifiers%20html#ol-layers)]\n * containing an [ol/layer/Vector](https://openlayers.org/en/latest/apidoc/module-ol_layer_Vector-VectorLayer.html)\n * with a [ol/source/Vector](https://openlayers.org/en/latest/apidoc/module-ol_source_Vector.html) on click.<br>\n * The default export format is KML, which supports the features' style export.<br>\n * Other formats do not always support style export (See specific format specs).\n */\nclass FeatureExportButton extends PureComponent {\n  static createFeatureString(layer, projection, format) {\n    if (format === KMLFormat) {\n      return KML.writeFeatures(layer, projection);\n    }\n\n    // eslint-disable-next-line new-cap\n    return new format().writeFeatures(layer.olLayer.getSource().getFeatures(), {\n      featureProjection: projection,\n    });\n  }\n\n  static exportFeatures(layer, projection, format) {\n    const now = new Date()\n      .toJSON()\n      .slice(0, 20)\n      .replace(/[.:T-]+/g, '');\n    const featString = this.createFeatureString(layer, projection, format);\n\n    const formatString = featString\n      ? featString.match(/<(\\w+)\\s+\\w+.*?>/)[1]\n      : 'xml';\n\n    const fileName = `exported_features_${now}.${formatString}`;\n    const charset = document.characterSet || 'UTF-8';\n    const type = `${\n      formatString === 'kml'\n        ? 'data:application/vnd.google-earth.kml+xml'\n        : 'data:text/xml'\n    };charset=${charset}`;\n\n    if (featString) {\n      if (window.navigator.msSaveBlob) {\n        // ie 11 and higher\n        window.navigator.msSaveBlob(new Blob([featString], { type }), fileName);\n      } else {\n        const link = document.createElement('a');\n        link.download = fileName;\n        link.href = `${type},${encodeURIComponent(featString)}`;\n        link.click();\n      }\n    }\n  }\n\n  render() {\n    const { children, layer, projection, format, ...other } = this.props;\n\n    return (\n      <div\n        role=\"button\"\n        className=\"rs-feature-export-button\"\n        tabIndex={0}\n        // eslint-disable-next-line react/jsx-props-no-spreading\n        {...other}\n        onClick={() =>\n          FeatureExportButton.exportFeatures(layer, projection, format)\n        }\n        onKeyPress={(evt) =>\n          evt.which === 13 &&\n          FeatureExportButton.exportFeatures(layer, projection, format)\n        }\n      >\n        {children}\n      </div>\n    );\n  }\n}\n\nFeatureExportButton.propTypes = propTypes;\nFeatureExportButton.defaultProps = defaultProps;\n\nexport default FeatureExportButton;\n"],"names":["const"],"mappings":"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"}