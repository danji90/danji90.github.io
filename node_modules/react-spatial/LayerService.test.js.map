{"version":3,"file":"LayerService.test.js","sources":["../src/LayerService.test.js"],"sourcesContent":["import 'jest-canvas-mock';\nimport { Layer } from 'mobility-toolbox-js/ol';\nimport LayerService from './LayerService';\n\ndescribe('LayerService', () => {\n  let layerService;\n\n  beforeEach(() => {\n    const layers = [\n      new Layer({\n        name: 'root',\n      }),\n      new Layer({\n        name: '1',\n        children: [\n          new Layer({\n            name: '1-1',\n            properties: {\n              radioGroup: 'radio',\n            },\n          }),\n          new Layer({\n            name: '1-2',\n            properties: {\n              radioGroup: 'radio',\n            },\n            visible: false,\n            children: [\n              new Layer({\n                name: '1-2-1',\n                visible: false,\n              }),\n              new Layer({\n                name: '1-2-2',\n                visible: false,\n              }),\n              new Layer({\n                name: '2',\n                visible: false,\n              }),\n            ],\n          }),\n        ],\n      }),\n    ];\n    layerService = new LayerService(layers);\n  });\n\n  test('should instantiate LayerService class correctly.', () => {\n    expect(layerService.getLayersAsFlatArray().length).toBe(7);\n  });\n\n  test('should return the correct number of layers.', () => {\n    expect(layerService.getLayers().length).toBe(2);\n  });\n\n  test('should return layers by name.', () => {\n    expect(layerService.getLayer('root')).toBeDefined();\n    expect(layerService.getLayer('1-2-2')).toBeDefined();\n    expect(layerService.getLayer('1-2')).toBeDefined();\n    expect(layerService.getLayer('42')).toBeUndefined();\n  });\n\n  test('should return the parent layer.', () => {\n    const child = layerService.getLayer('1-2');\n    expect(layerService.getParent(child).name).toBe('1');\n  });\n\n  test('should return null if no radio name is given.', () => {\n    expect(layerService.getRadioGroupLayers()).toBe(null);\n  });\n\n  test('should return radio layers.', () => {\n    expect(layerService.getRadioGroupLayers('radio').length).toBe(2);\n    expect(layerService.getRadioGroupLayers('no-radio').length).toBe(0);\n  });\n\n  test('should toggle radio layers.', () => {\n    layerService.getLayer('1-1').setVisible(true);\n    expect(layerService.getLayer('1-1').visible).toBe(true);\n    layerService.getLayer('1-2').setVisible(true);\n    expect(layerService.getLayer('1-1').visible).toBe(false);\n  });\n\n  test('should toggle child layers.', () => {\n    layerService.getLayer('1-2').setVisible(true);\n    expect(layerService.getLayer('1-2-1').visible).toBe(true);\n    expect(layerService.getLayer('1-2-2').visible).toBe(true);\n    expect(layerService.getLayer('2').visible).toBe(true);\n  });\n\n  test('should call back on visibility changes.', () => {\n    const callback = jest.fn(() => 42);\n    layerService.on('change:visible', callback);\n    layerService.getLayer('2').setVisible(true);\n    expect(callback.mock.calls.length).toBe(3);\n  });\n\n  test('should set children from constructor', () => {\n    const layer = new Layer({\n      name: 'foo',\n      children: [\n        new Layer({\n          name: 'bar',\n        }),\n      ],\n    });\n    expect(layer.children.length).toBe(1);\n  });\n\n  describe('#on() ', () => {\n    test('add a callback on event.', () => {\n      const cb = () => {};\n      layerService.on('foo', cb);\n      expect(layerService.callbacks.foo[0]).toBe(cb);\n    });\n\n    test(\"doesn't add twice the same callback .\", () => {\n      const cb = () => {};\n      layerService.on('foo', cb);\n      expect(layerService.callbacks.foo[0]).toBe(cb);\n      layerService.on('foo', cb);\n      expect(layerService.callbacks.foo[0]).toBe(cb);\n      expect(layerService.callbacks.foo[1]).toBe(undefined);\n    });\n  });\n\n  describe('#un() ', () => {\n    test(\"doesn't failed if callback doesn't exists.\", (done) => {\n      const cb = () => {};\n      try {\n        layerService.un('foo', cb);\n        done();\n        // eslint-disable-next-line no-empty\n      } catch (e) {}\n    });\n\n    test('remove a callback on event.', () => {\n      const cb = () => {};\n      const cb1 = () => {};\n      const cb2 = () => {};\n      layerService.on('foo', cb);\n      layerService.on('foo', cb1);\n      layerService.on('foo', cb2);\n      expect(layerService.callbacks.foo[0]).toBe(cb);\n      expect(layerService.callbacks.foo[1]).toBe(cb1);\n      expect(layerService.callbacks.foo[2]).toBe(cb2);\n      layerService.un('foo', cb1);\n      expect(layerService.callbacks.foo[0]).toBe(cb);\n      expect(layerService.callbacks.foo[1]).toBe(cb2);\n      expect(layerService.callbacks.foo[2]).toBe(undefined);\n    });\n  });\n\n  test('should unlisten keys in LayerService', () => {\n    expect(layerService.keys.length).toBe(14);\n    layerService.setLayers([]);\n    expect(layerService.keys.length).toBe(0);\n  });\n});\n"],"names":["let","const"],"mappings":"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"}