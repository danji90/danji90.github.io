{"ast":null,"code":"import _objectSpread from \"/home/daniel/gitRepos/danji90.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _classCallCheck from \"/home/daniel/gitRepos/danji90.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/daniel/gitRepos/danji90.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _get from \"/home/daniel/gitRepos/danji90.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"/home/daniel/gitRepos/danji90.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/daniel/gitRepos/danji90.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/daniel/gitRepos/danji90.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport { unByKey } from 'ol/Observable';\nimport Layer from './Layer';\n/**\n * A class use to display vector data.\n *\n * @extends {Layer}\n */\n\nvar VectorLayer = /*#__PURE__*/function (_Layer) {\n  _inherits(VectorLayer, _Layer);\n\n  var _super = _createSuper(VectorLayer);\n\n  /**\n   * Constructor.\n   *\n   * @param {Object} [options]\n   * @param {number} [options.hitTolerance=5] Pixel value of the click hitTolerance of clicks.\n   */\n  function VectorLayer() {\n    var _this;\n\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, VectorLayer);\n\n    _this = _super.call(this, options);\n    /** @ignore */\n\n    _this.hitTolerance = options.hitTolerance || 5;\n    return _this;\n  }\n  /**\n   * Request feature information for a given coordinate.\n   * @param {ol/coordinate~Coordinate} coordinate the coordinate to request the information at.\n   * @returns {Promise<Object>} Promise with features, layer and coordinate\n   *  or null if no feature was hit.\n   * eslint-disable-next-line class-methods-use-this\n   */\n\n\n  _createClass(VectorLayer, [{\n    key: \"getFeatureInfoAtCoordinate\",\n    value: function getFeatureInfoAtCoordinate(coordinate) {\n      var _this2 = this;\n\n      var features = [];\n\n      if (this.map) {\n        var pixel = this.map.getPixelFromCoordinate(coordinate);\n        features = this.map.getFeaturesAtPixel(pixel, {\n          layerFilter: function layerFilter(l) {\n            return l === _this2.olLayer;\n          },\n          hitTolerance: this.hitTolerance\n        });\n      }\n\n      return Promise.resolve({\n        features: features,\n        layer: this,\n        coordinate: coordinate\n      });\n    }\n    /**\n     * Initialize the layer and listen to feature clicks.\n     * @param {ol/Map~Map} map\n     */\n\n  }, {\n    key: \"init\",\n    value: function init(map) {\n      var _this3 = this;\n\n      _get(_getPrototypeOf(VectorLayer.prototype), \"init\", this).call(this, map);\n\n      if (!this.map) {\n        return;\n      }\n      /**\n       * ol click events key, returned by map.on('singleclick')\n       * @type {ol/events~EventsKey}\n       * @private\n       */\n\n\n      this.singleClickRef = this.map.on('singleclick', function (e) {\n        if (!_this3.clickCallbacks.length) {\n          return;\n        }\n\n        _this3.getFeatureInfoAtCoordinate(e.coordinate).then(function (d) {\n          return _this3.callClickCallbacks(d.features, d.layer, d.coordinate);\n        }).catch(function () {\n          return _this3.callClickCallbacks([], _this3, e.coordinate);\n        });\n      });\n    }\n    /**\n     * Call click callbacks with given parameters.\n     * This is done in a separate function for being able to modify the response.\n     * @param {Array<ol/Feature~Feature>} features\n     * @param {ol/layer/Layer~Layer} layer\n     * @param {ol/coordinate~Coordinate} coordinate\n     * @private\n     */\n\n  }, {\n    key: \"callClickCallbacks\",\n    value: function callClickCallbacks(features, layer, coordinate) {\n      this.clickCallbacks.forEach(function (c) {\n        return c(features, layer, coordinate);\n      });\n    }\n    /**\n     * Terminate what was initialized in init function. Remove layer, events...\n     */\n\n  }, {\n    key: \"terminate\",\n    value: function terminate() {\n      _get(_getPrototypeOf(VectorLayer.prototype), \"terminate\", this).call(this);\n\n      if (this.singleClickRef) {\n        unByKey(this.singleClickRef);\n      }\n    }\n    /**\n     * Create a copy of the VectorLayer.\n     * @param {Object} newOptions Options to override\n     * @returns {VectorLayer} A VectorLayer\n     */\n\n  }, {\n    key: \"clone\",\n    value: function clone(newOptions) {\n      return new VectorLayer(_objectSpread(_objectSpread({}, this.options), newOptions));\n    }\n  }]);\n\n  return VectorLayer;\n}(Layer);\n\nexport default VectorLayer;","map":{"version":3,"sources":["/home/daniel/gitRepos/danji90.github.io/node_modules/mobility-toolbox-js/ol/layers/VectorLayer.js"],"names":["unByKey","Layer","VectorLayer","options","hitTolerance","coordinate","features","map","pixel","getPixelFromCoordinate","getFeaturesAtPixel","layerFilter","l","olLayer","Promise","resolve","layer","singleClickRef","on","e","clickCallbacks","length","getFeatureInfoAtCoordinate","then","d","callClickCallbacks","catch","forEach","c","newOptions"],"mappings":";;;;;;;AAAA,SAASA,OAAT,QAAwB,eAAxB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AAEA;AACA;AACA;AACA;AACA;;IACMC,W;;;;;AACJ;AACF;AACA;AACA;AACA;AACA;AACE,yBAA0B;AAAA;;AAAA,QAAdC,OAAc,uEAAJ,EAAI;;AAAA;;AACxB,8BAAMA,OAAN;AAEA;;AACA,UAAKC,YAAL,GAAoBD,OAAO,CAACC,YAAR,IAAwB,CAA5C;AAJwB;AAKzB;AAED;AACF;AACA;AACA;AACA;AACA;AACA;;;;;WACE,oCAA2BC,UAA3B,EAAuC;AAAA;;AACrC,UAAIC,QAAQ,GAAG,EAAf;;AAEA,UAAI,KAAKC,GAAT,EAAc;AACZ,YAAMC,KAAK,GAAG,KAAKD,GAAL,CAASE,sBAAT,CAAgCJ,UAAhC,CAAd;AACAC,QAAAA,QAAQ,GAAG,KAAKC,GAAL,CAASG,kBAAT,CAA4BF,KAA5B,EAAmC;AAC5CG,UAAAA,WAAW,EAAE,qBAACC,CAAD;AAAA,mBAAOA,CAAC,KAAK,MAAI,CAACC,OAAlB;AAAA,WAD+B;AAE5CT,UAAAA,YAAY,EAAE,KAAKA;AAFyB,SAAnC,CAAX;AAID;;AAED,aAAOU,OAAO,CAACC,OAAR,CAAgB;AACrBT,QAAAA,QAAQ,EAARA,QADqB;AAErBU,QAAAA,KAAK,EAAE,IAFc;AAGrBX,QAAAA,UAAU,EAAVA;AAHqB,OAAhB,CAAP;AAKD;AAED;AACF;AACA;AACA;;;;WACE,cAAKE,GAAL,EAAU;AAAA;;AACR,4EAAWA,GAAX;;AAEA,UAAI,CAAC,KAAKA,GAAV,EAAe;AACb;AACD;AAED;AACJ;AACA;AACA;AACA;;;AACI,WAAKU,cAAL,GAAsB,KAAKV,GAAL,CAASW,EAAT,CAAY,aAAZ,EAA2B,UAACC,CAAD,EAAO;AACtD,YAAI,CAAC,MAAI,CAACC,cAAL,CAAoBC,MAAzB,EAAiC;AAC/B;AACD;;AAED,QAAA,MAAI,CAACC,0BAAL,CAAgCH,CAAC,CAACd,UAAlC,EACGkB,IADH,CACQ,UAACC,CAAD;AAAA,iBAAO,MAAI,CAACC,kBAAL,CAAwBD,CAAC,CAAClB,QAA1B,EAAoCkB,CAAC,CAACR,KAAtC,EAA6CQ,CAAC,CAACnB,UAA/C,CAAP;AAAA,SADR,EAEGqB,KAFH,CAES;AAAA,iBAAM,MAAI,CAACD,kBAAL,CAAwB,EAAxB,EAA4B,MAA5B,EAAkCN,CAAC,CAACd,UAApC,CAAN;AAAA,SAFT;AAGD,OARqB,CAAtB;AASD;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;;WACE,4BAAmBC,QAAnB,EAA6BU,KAA7B,EAAoCX,UAApC,EAAgD;AAC9C,WAAKe,cAAL,CAAoBO,OAApB,CAA4B,UAACC,CAAD;AAAA,eAAOA,CAAC,CAACtB,QAAD,EAAWU,KAAX,EAAkBX,UAAlB,CAAR;AAAA,OAA5B;AACD;AAED;AACF;AACA;;;;WACE,qBAAY;AACV;;AACA,UAAI,KAAKY,cAAT,EAAyB;AACvBjB,QAAAA,OAAO,CAAC,KAAKiB,cAAN,CAAP;AACD;AACF;AAED;AACF;AACA;AACA;AACA;;;;WACE,eAAMY,UAAN,EAAkB;AAChB,aAAO,IAAI3B,WAAJ,iCAAqB,KAAKC,OAA1B,GAAsC0B,UAAtC,EAAP;AACD;;;;EA/FuB5B,K;;AAkG1B,eAAeC,WAAf","sourcesContent":["import { unByKey } from 'ol/Observable';\nimport Layer from './Layer';\n\n/**\n * A class use to display vector data.\n *\n * @extends {Layer}\n */\nclass VectorLayer extends Layer {\n  /**\n   * Constructor.\n   *\n   * @param {Object} [options]\n   * @param {number} [options.hitTolerance=5] Pixel value of the click hitTolerance of clicks.\n   */\n  constructor(options = {}) {\n    super(options);\n\n    /** @ignore */\n    this.hitTolerance = options.hitTolerance || 5;\n  }\n\n  /**\n   * Request feature information for a given coordinate.\n   * @param {ol/coordinate~Coordinate} coordinate the coordinate to request the information at.\n   * @returns {Promise<Object>} Promise with features, layer and coordinate\n   *  or null if no feature was hit.\n   * eslint-disable-next-line class-methods-use-this\n   */\n  getFeatureInfoAtCoordinate(coordinate) {\n    let features = [];\n\n    if (this.map) {\n      const pixel = this.map.getPixelFromCoordinate(coordinate);\n      features = this.map.getFeaturesAtPixel(pixel, {\n        layerFilter: (l) => l === this.olLayer,\n        hitTolerance: this.hitTolerance,\n      });\n    }\n\n    return Promise.resolve({\n      features,\n      layer: this,\n      coordinate,\n    });\n  }\n\n  /**\n   * Initialize the layer and listen to feature clicks.\n   * @param {ol/Map~Map} map\n   */\n  init(map) {\n    super.init(map);\n\n    if (!this.map) {\n      return;\n    }\n\n    /**\n     * ol click events key, returned by map.on('singleclick')\n     * @type {ol/events~EventsKey}\n     * @private\n     */\n    this.singleClickRef = this.map.on('singleclick', (e) => {\n      if (!this.clickCallbacks.length) {\n        return;\n      }\n\n      this.getFeatureInfoAtCoordinate(e.coordinate)\n        .then((d) => this.callClickCallbacks(d.features, d.layer, d.coordinate))\n        .catch(() => this.callClickCallbacks([], this, e.coordinate));\n    });\n  }\n\n  /**\n   * Call click callbacks with given parameters.\n   * This is done in a separate function for being able to modify the response.\n   * @param {Array<ol/Feature~Feature>} features\n   * @param {ol/layer/Layer~Layer} layer\n   * @param {ol/coordinate~Coordinate} coordinate\n   * @private\n   */\n  callClickCallbacks(features, layer, coordinate) {\n    this.clickCallbacks.forEach((c) => c(features, layer, coordinate));\n  }\n\n  /**\n   * Terminate what was initialized in init function. Remove layer, events...\n   */\n  terminate() {\n    super.terminate();\n    if (this.singleClickRef) {\n      unByKey(this.singleClickRef);\n    }\n  }\n\n  /**\n   * Create a copy of the VectorLayer.\n   * @param {Object} newOptions Options to override\n   * @returns {VectorLayer} A VectorLayer\n   */\n  clone(newOptions) {\n    return new VectorLayer({ ...this.options, ...newOptions });\n  }\n}\n\nexport default VectorLayer;\n"]},"metadata":{},"sourceType":"module"}