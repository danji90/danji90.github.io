{"ast":null,"code":"import _objectSpread from \"/home/daniel/gitRepos/danji90.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _inherits from \"/home/daniel/gitRepos/danji90.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/home/daniel/gitRepos/danji90.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport _classCallCheck from \"/home/daniel/gitRepos/danji90.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/daniel/gitRepos/danji90.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\n/* eslint-disable no-empty-function */\n\n/* eslint-disable no-useless-constructor */\n\n/* eslint-disable class-methods-use-this */\n\n/* eslint-disable max-classes-per-file */\nimport StopsAPI from '../../api/stops/StopsAPI';\n/**\n * Search control interface.\n *\n * @classproperty {StopsSearchParams} apiParams - Default request parameters used by the search method. See [Stops service documentation](https://developer.geops.io/apis/5dcbd702a256d90001cf1361/).\n */\n\nexport var SearchInterface = /*#__PURE__*/function () {\n  /**\n   * Constructor.\n   *\n   * @param {Object} options Map options\n   * @param {string} options.apiKey Access key for [geOps services](https://developer.geops.io/). See StopsAPI.\n   * @param {string} [options.url='https://api.geops.io/tracker/v1'] Stops service url. See StopsAPI.\n   * @param {string} [options.placeholder='Search for a stop...'] Input field placeholder.\n   * @param {StopsSearchParams} [options.apiParams={ limit: 20 }] Request parameters. See [Stops service documentation](https://developer.geops.io/apis/5dcbd702a256d90001cf1361/).\n   */\n  // eslint-disable-next-line no-unused-vars\n  function SearchInterface() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, SearchInterface);\n  }\n  /**\n   * Launch a search.\n   *\n   * @param {String} query The query to search for.\n   * @param {AbortController} abortController Abort controller used to cancel the request.\n   * @returns {Promise<GeoJSONFeature[]>} An array of GeoJSON features with coordinates in [EPSG:4326](http://epsg.io/4326).\n   */\n  // eslint-disable-next-line no-unused-vars\n\n\n  _createClass(SearchInterface, [{\n    key: \"search\",\n    value: function search(query, abortController) {}\n  }]);\n\n  return SearchInterface;\n}();\n/**\n * Mixin for SearchInterface.\n *\n * @param {Class} Base  A class to extend with {SearchInterface} functionnalities.\n * @return {Class}  A class that implements <SearchInterface> class and extends Base;\n * @private\n */\n\nvar SearchMixin = function SearchMixin(Base) {\n  return /*#__PURE__*/function (_Base) {\n    _inherits(_class, _Base);\n\n    var _super = _createSuper(_class);\n\n    function _class() {\n      var _this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      _classCallCheck(this, _class);\n\n      _this = _super.call(this, options);\n      var apiParams = options.apiParams,\n          apiKey = options.apiKey,\n          url = options.url;\n      _this.apiParams = _objectSpread({\n        limit: 20\n      }, apiParams || {});\n      _this.placeholder = options.placeholder || 'Search for a stop...';\n      var apiOptions = {\n        apiKey: apiKey\n      };\n\n      if (url) {\n        apiOptions.url = url;\n      }\n\n      _this.api = new StopsAPI(apiOptions);\n      return _this;\n    }\n\n    _createClass(_class, [{\n      key: \"render\",\n      value: function render() {\n        var _this2 = this;\n\n        var suggestions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n        if (!this.suggestionsElt) {\n          return;\n        }\n\n        this.suggestionsElt.style.display = suggestions.length ? 'block' : 'none';\n        this.suggestionsElt.innerHTML = '';\n        suggestions.forEach(function (suggestion) {\n          var properties = suggestion.properties;\n          var suggElt = document.createElement('div');\n          suggElt.innerHTML = properties.name;\n\n          suggElt.onclick = function () {\n            _this2.onSuggestionClick(suggestion);\n          };\n\n          Object.assign(suggElt.style, {\n            padding: '5px 12px'\n          });\n\n          _this2.suggestionsElt.appendChild(suggElt);\n        });\n      }\n    }, {\n      key: \"createDefaultElement\",\n      value: function createDefaultElement() {\n        var _this3 = this;\n\n        /**\n         * Define a default element.\n         */\n        this.element = document.createElement('div');\n        this.element.id = 'mbt-search';\n        Object.assign(this.element.style, {\n          position: 'absolute',\n          top: 0,\n          left: '50px',\n          margin: '10px',\n          display: 'flex',\n          flexDirection: 'column',\n          width: '320px'\n        }); // Create input element\n\n        this.inputElt = document.createElement('input');\n        this.inputElt.type = 'text';\n        this.inputElt.placeholder = this.placeholder;\n        this.inputElt.autoComplete = 'off';\n\n        this.inputElt.onkeyup = function (evt) {\n          _this3.search(evt.target.value);\n        };\n\n        Object.assign(this.inputElt.style, {\n          padding: '10px 30px 10px 10px'\n        });\n        this.element.appendChild(this.inputElt); // Create suggestions list element\n\n        this.suggestionsElt = document.createElement('div');\n        Object.assign(this.suggestionsElt.style, {\n          backgroundColor: 'white',\n          overflowY: 'auto',\n          cursor: 'pointer'\n        });\n        this.element.appendChild(this.suggestionsElt);\n        this.clearElt = document.createElement('div');\n        Object.assign(this.clearElt.style, {\n          display: 'none',\n          position: 'absolute',\n          right: '0',\n          padding: '10px',\n          fontSize: '200%',\n          cursor: 'pointer'\n        });\n        this.clearElt.innerHTML = '×';\n\n        this.clearElt.onclick = function () {\n          return _this3.clear();\n        };\n\n        this.element.appendChild(this.clearElt);\n      }\n    }, {\n      key: \"search\",\n      value: function search(q, abortController) {\n        var _this4 = this;\n\n        if (q !== undefined || q !== null) {\n          this.apiParams.q = q;\n        }\n\n        if (this.clearElt) {\n          this.clearElt.style.display = 'block';\n        }\n\n        return this.api.search(this.apiParams, abortController).then(function (data) {\n          _this4.render(data);\n        }).catch(function () {\n          _this4.render();\n        });\n      }\n      /**\n       * To be defined in inherited class\n       */\n      // eslint-disable-next-line no-unused-vars\n\n    }, {\n      key: \"onSuggestionClick\",\n      value: function onSuggestionClick(suggestion) {}\n      /**\n       * Clear the search field and close the control.\n       */\n\n    }, {\n      key: \"clear\",\n      value: function clear() {\n        if (!this.suggestionsElt) {\n          return;\n        }\n\n        this.inputElt.value = '';\n        this.suggestionsElt.innerHTML = '';\n        this.clearElt.style.display = 'none';\n      }\n    }]);\n\n    return _class;\n  }(Base);\n};\n\nexport default SearchMixin;","map":{"version":3,"sources":["/home/daniel/gitRepos/danji90.github.io/node_modules/mobility-toolbox-js/common/mixins/SearchMixin.js"],"names":["StopsAPI","SearchInterface","options","query","abortController","SearchMixin","Base","apiParams","apiKey","url","limit","placeholder","apiOptions","api","suggestions","suggestionsElt","style","display","length","innerHTML","forEach","suggestion","properties","suggElt","document","createElement","name","onclick","onSuggestionClick","Object","assign","padding","appendChild","element","id","position","top","left","margin","flexDirection","width","inputElt","type","autoComplete","onkeyup","evt","search","target","value","backgroundColor","overflowY","cursor","clearElt","right","fontSize","clear","q","undefined","then","data","render","catch"],"mappings":"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","sourcesContent":["/* eslint-disable no-empty-function */\n/* eslint-disable no-useless-constructor */\n/* eslint-disable class-methods-use-this */\n/* eslint-disable max-classes-per-file */\nimport StopsAPI from '../../api/stops/StopsAPI';\n\n/**\n * Search control interface.\n *\n * @classproperty {StopsSearchParams} apiParams - Default request parameters used by the search method. See [Stops service documentation](https://developer.geops.io/apis/5dcbd702a256d90001cf1361/).\n */\nexport class SearchInterface {\n  /**\n   * Constructor.\n   *\n   * @param {Object} options Map options\n   * @param {string} options.apiKey Access key for [geOps services](https://developer.geops.io/). See StopsAPI.\n   * @param {string} [options.url='https://api.geops.io/tracker/v1'] Stops service url. See StopsAPI.\n   * @param {string} [options.placeholder='Search for a stop...'] Input field placeholder.\n   * @param {StopsSearchParams} [options.apiParams={ limit: 20 }] Request parameters. See [Stops service documentation](https://developer.geops.io/apis/5dcbd702a256d90001cf1361/).\n   */\n  // eslint-disable-next-line no-unused-vars\n  constructor(options = {}) {}\n\n  /**\n   * Launch a search.\n   *\n   * @param {String} query The query to search for.\n   * @param {AbortController} abortController Abort controller used to cancel the request.\n   * @returns {Promise<GeoJSONFeature[]>} An array of GeoJSON features with coordinates in [EPSG:4326](http://epsg.io/4326).\n   */\n  // eslint-disable-next-line no-unused-vars\n  search(query, abortController) {}\n}\n\n/**\n * Mixin for SearchInterface.\n *\n * @param {Class} Base  A class to extend with {SearchInterface} functionnalities.\n * @return {Class}  A class that implements <SearchInterface> class and extends Base;\n * @private\n */\nconst SearchMixin = (Base) =>\n  class extends Base {\n    constructor(options = {}) {\n      super(options);\n      const { apiParams, apiKey, url } = options;\n\n      this.apiParams = { limit: 20, ...(apiParams || {}) };\n      this.placeholder = options.placeholder || 'Search for a stop...';\n\n      const apiOptions = { apiKey };\n      if (url) {\n        apiOptions.url = url;\n      }\n      this.api = new StopsAPI(apiOptions);\n    }\n\n    render(suggestions = []) {\n      if (!this.suggestionsElt) {\n        return;\n      }\n\n      this.suggestionsElt.style.display = suggestions.length ? 'block' : 'none';\n\n      this.suggestionsElt.innerHTML = '';\n\n      suggestions.forEach((suggestion) => {\n        const { properties } = suggestion;\n        const suggElt = document.createElement('div');\n        suggElt.innerHTML = properties.name;\n        suggElt.onclick = () => {\n          this.onSuggestionClick(suggestion);\n        };\n        Object.assign(suggElt.style, {\n          padding: '5px 12px',\n        });\n        this.suggestionsElt.appendChild(suggElt);\n      });\n    }\n\n    createDefaultElement() {\n      /**\n       * Define a default element.\n       */\n      this.element = document.createElement('div');\n      this.element.id = 'mbt-search';\n      Object.assign(this.element.style, {\n        position: 'absolute',\n        top: 0,\n        left: '50px',\n        margin: '10px',\n        display: 'flex',\n        flexDirection: 'column',\n        width: '320px',\n      });\n\n      // Create input element\n      this.inputElt = document.createElement('input');\n      this.inputElt.type = 'text';\n      this.inputElt.placeholder = this.placeholder;\n      this.inputElt.autoComplete = 'off';\n      this.inputElt.onkeyup = (evt) => {\n        this.search(evt.target.value);\n      };\n      Object.assign(this.inputElt.style, {\n        padding: '10px 30px 10px 10px',\n      });\n      this.element.appendChild(this.inputElt);\n\n      // Create suggestions list element\n      this.suggestionsElt = document.createElement('div');\n      Object.assign(this.suggestionsElt.style, {\n        backgroundColor: 'white',\n        overflowY: 'auto',\n        cursor: 'pointer',\n      });\n      this.element.appendChild(this.suggestionsElt);\n\n      this.clearElt = document.createElement('div');\n      Object.assign(this.clearElt.style, {\n        display: 'none',\n        position: 'absolute',\n        right: '0',\n        padding: '10px',\n        fontSize: '200%',\n        cursor: 'pointer',\n      });\n      this.clearElt.innerHTML = '×';\n      this.clearElt.onclick = () => this.clear();\n      this.element.appendChild(this.clearElt);\n    }\n\n    search(q, abortController) {\n      if (q !== undefined || q !== null) {\n        this.apiParams.q = q;\n      }\n\n      if (this.clearElt) {\n        this.clearElt.style.display = 'block';\n      }\n\n      return this.api\n        .search(this.apiParams, abortController)\n        .then((data) => {\n          this.render(data);\n        })\n        .catch(() => {\n          this.render();\n        });\n    }\n\n    /**\n     * To be defined in inherited class\n     */\n    // eslint-disable-next-line no-unused-vars\n    onSuggestionClick(suggestion) {}\n\n    /**\n     * Clear the search field and close the control.\n     */\n    clear() {\n      if (!this.suggestionsElt) {\n        return;\n      }\n\n      this.inputElt.value = '';\n      this.suggestionsElt.innerHTML = '';\n      this.clearElt.style.display = 'none';\n    }\n  };\n\nexport default SearchMixin;\n"]},"metadata":{},"sourceType":"module"}